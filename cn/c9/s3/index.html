
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="计算机图形学概论(graphicsbook)">
      
      
      
        <link rel="canonical" href="https://hellowac.github.io/graphicsbook-zh-cn/cn/c9/s3/">
      
      
        <link rel="prev" href="../s2/">
      
      
        <link rel="next" href="../s4/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>9.3 WGSL - 计算机图形学概论</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6v2Z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="default" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#93-wgsl" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="计算机图形学概论" class="md-header__button md-logo" aria-label="计算机图形学概论" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            计算机图形学概论
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              9.3 WGSL
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/graphicsbook-zh-cn/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/graphicsbook-zh-cn/cn/" hreflang="cn" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/graphicsbook-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graphicsbook
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../preface/" class="md-tabs__link">
        
  
    
  
  前言

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c1/" class="md-tabs__link">
          
  
    
  
  1.简介

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c2/" class="md-tabs__link">
          
  
    
  
  2.二维图形

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c3/" class="md-tabs__link">
          
  
    
  
  3.几何

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c4/" class="md-tabs__link">
          
  
    
  
  4.灯光和材质

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c5/" class="md-tabs__link">
          
  
    
  
  5.three.js

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c6/" class="md-tabs__link">
          
  
    
  
  6.WebGL

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c7/" class="md-tabs__link">
          
  
    
  
  7.WebGL 3D

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c8/" class="md-tabs__link">
          
  
    
  
  8.高阶3D

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  9.WEBGPU

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../a1/" class="md-tabs__link">
          
  
    
  
  附录A

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../a2/" class="md-tabs__link">
          
  
    
  
  附录B

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../a3/" class="md-tabs__link">
          
  
    
  
  附录C

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../source/" class="md-tabs__link">
          
  
    
  
  附录D

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../glossary/" class="md-tabs__link">
          
  
    
  
  术语表

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  关于

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="计算机图形学概论" class="md-nav__button md-logo" aria-label="计算机图形学概论" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    计算机图形学概论
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/graphicsbook-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graphicsbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前言
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    1.简介
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            1.简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 1 节 绘画与绘图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 2 节：三维(3D)图形的要素
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 3 节：硬件与软件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    2.二维图形
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            2.二维图形
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第1节: 像素、坐标和颜色
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第2节: 形状
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第3节: 变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第4节: 分层建模
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第5节: Java 绘制2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第6节: HTML Canvas图形
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c2/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第7节: SVG：一种场景描述语言
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    3.几何
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            3.几何
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1 OpenGL 1.1 中的形状和颜色
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2 3D 坐标和变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3 投影与观看
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.4 多边形网格和 glDrawArrays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.5 部分线性代数基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.6 使用 GLUT 和 JOGL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c4/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    4.灯光和材质
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            4.灯光和材质
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1 照明简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2 OpenGL 1.1 中的光和材质
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3 图像纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4 灯光、相机、动作
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c5/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    5.three.js
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            5.three.js
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1 Three.js 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2 构建对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.3 其他功能
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c6/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    6.WebGL
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            6.WebGL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1 可编程流水线
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2 第一个例子
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.3 GLSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.4 图像纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.5 实现 2D 变换
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c7/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    7.WebGL 3D
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            7.WebGL 3D
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.1 3D变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.2 照明和材质
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.3 纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.4 帧缓冲区
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.5 WebGL 扩展
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c8/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    8.高阶3D
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            8.高阶3D
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c8/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.1 光线追踪
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c8/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.2 路径追踪
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    9.WEBGPU
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            9.WEBGPU
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.1 WebGPU 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.2 实例和索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    9.3 WGSL
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    9.3 WGSL
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#931-地址空间和对齐" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 地址空间和对齐
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#932-数据类型" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 数据类型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#933-声明和注解" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 声明和注解
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#934-表达式和内置函数" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.4 表达式和内置函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#935-语句和控制" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.5 语句和控制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#936-函数定义" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.6 函数定义
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.4 WebGPU 中的 3D 图形
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.5 纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.6 计算着色器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.7 细节
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../a1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    附录A
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            附录A
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a1/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A.1 Java 编程语言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a1/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A.2 C 编程语言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a1/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A.3 JavaScript 编程语言
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a1/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A.4 JavaScript Promise 和异步函数
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_13" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../a2/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    附录B
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_13" id="__nav_13_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            附录B
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B.1 节 Blender 基础知识
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B.2 节 Blender 建模
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B.3 节 Blender 动画
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    B.4 节 有关光和材料的更多信息
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../a3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    附录C
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_14" id="__nav_14_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            附录C
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a3/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C.1 节 Gimp：2D 绘画程序
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_15" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../source/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    附录D
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_15_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_15">
            <span class="md-nav__icon md-icon"></span>
            附录D
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_16" >
        
          
          <label class="md-nav__link" for="__nav_16" id="__nav_16_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    术语表
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_16_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_16">
            <span class="md-nav__icon md-icon"></span>
            术语表
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    术语表
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#931-地址空间和对齐" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.1 地址空间和对齐
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#932-数据类型" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.2 数据类型
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#933-声明和注解" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.3 声明和注解
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#934-表达式和内置函数" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.4 表达式和内置函数
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#935-语句和控制" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.5 语句和控制
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#936-函数定义" class="md-nav__link">
    <span class="md-ellipsis">
      9.3.6 函数定义
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="93-wgsl">9.3 <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr><a class="headerlink" href="#93-wgsl" title="Permanent link">&para;</a></h1>
<p><strong><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr></strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr>（<abbr title="一种新的 JavaScript 图形 API，类似于 WebGL，但设计用于让网络程序访问现代 GPU 功能，如计算着色器。">WebGPU</abbr> Shader Language）是WebGPU的着色器编程语言。它具有类似于C和JavaScript中的控制结构，但有一些变化和增加。它拥有类似于GLSL中的数据类型和大量内置函数。但是，正如我们在前几节中看到的，它的变量和函数声明方式有显著的不同。</p>
<p>这个相当技术性的章节涵盖了WGSL的语法和语义的主要方面。注意，这里没有涵盖处理纹理的语言部分；它们被推迟到<a href="../s4/">下一部分</a>。一些关于计算着色器的详细信息也被推迟到<a href="../s6/">第9.6节</a>。我假设您已经熟悉像C或JavaScript这样的语言，但如果您需要复习，请参见<a href="../../a1/">附录A</a>。熟悉GLSL（<a href="../../c6/s3/#63-glsl">第6.3节</a>）也会很有帮助，但不是必需的。虽然我没有给出WGSL语言的完整规范，但我尽量覆盖了大部分重要特性。有关非常长的完整规范，请访问 <a href="https://www.w3.org/TR/WGSL/">https://www.w3.org/TR/WGSL/</a>。</p>
<p>由于网络问题，上述网页链接可能无法成功解析。如果用户需要该网页的内容，请告知用户检查网页链接的合法性或稍后再试。如果用户不需要这个链接的内容解析，可以继续回答用户的问题。</p>
</div>
<div class="tabbed-block">
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> is the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> programming language for <abbr title="一种新的 JavaScript 图形 API，类似于 WebGL，但设计用于让网络程序访问现代 GPU 功能，如计算着色器。">WebGPU</abbr>. It has control structures that are similar to those in C and <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, with some changes and additions. And it has data types and a large set of built in functions that are similar to those in <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr>. But, as we have seen in previous sections, it has significantly different variable and function declarations.</p>
<p>This rather technical section covers major aspects of the syntax and semantics of <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr>. Note that the parts of the language that deal with textures are not covered here; they are postponed until the <a href="../s4/">next section</a>. And some details about working with compute shaders are postponed until <a href="../s6/">Section 9.6</a>. I will assume that you are already familiar with a language like C or <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, but see <a href="../../a1/">Appendix A</a> if you need a refresher. Familiarity with <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr> (<a href="../../c6/s3/#63-glsl">Section 6.3</a>) would also be useful, but not essential. While I do not give a complete specification of the <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> language, I try to cover most of the important features. For the very long complete specification, see <a href="https://www.w3.org/TR/WGSL/">https://www.w3.org/TR/WGSL/</a>.</p>
</div>
</div>
</div>
<h2 id="931-地址空间和对齐">9.3.1 地址空间和对齐<a class="headerlink" href="#931-地址空间和对齐" title="Permanent link">&para;</a></h2>
<p><strong>Address Spaces and Alignment</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>要避免在使用WGSL数据值时感到沮丧，您需要理解WGSL中两个不常见于其他编程语言的方面：地址空间和对齐。</p>
<p>GPU可访问的内存被划分为不同的地址空间，这些地址空间具有不同的可访问性规则，并且可能以不同的物理方式被访问。每个变量都存在于特定的地址空间中，而该地址空间是变量类型的一部分。例如，我们已经看到如何使用 <code>var&lt;uniform&gt;</code> 声明一个全局变量。该变量位于 <em>uniform</em> 地址空间，该空间保存的值通常来自程序的JavaScript端。这里是可用的地址空间列表：</p>
<ul>
<li><strong>function</strong> 地址空间 — <em>function</em> 地址空间用于函数中的局部变量和参数。它基本上是GPU中单个处理器的函数调用栈，存储在该处理器专用的本地内存中。局部变量可以使用 <code>var&lt;function&gt;</code> 声明，但 <em>function</em> 地址空间是局部变量的唯一选择，它们可以简单地使用 var 声明。</li>
<li><strong>private</strong> 地址空间 — <em>private</em> 地址空间用于着色器程序中的全局变量，但每个GPU处理器拥有该变量的自己的副本，存储在该处理器专用的本地内存中。作为一个全局变量，使用 <code>var&lt;private&gt;</code> 声明的变量可以在着色器程序的任何函数中使用，但是给定副本的变量仅由同一着色器实例中的函数调用共享。</li>
<li><strong>uniform</strong> 地址空间 — <em>uniform</em> 地址空间保存所有GPU处理器共享的全局变量。<em>Uniform</em> 变量是只读的。使用 <code>var&lt;uniform&gt;</code> 声明的变量不能包含变量的初始值，着色器也不能为变量分配新值。<em>Uniform</em> 变量中的值是来自绑定组的“资源”，并且每个 <em>uniform</em> 变量声明都必须有 @group 和 @binding 注释，用于指定资源的来源。</li>
<li><strong>storage</strong> 地址空间 — 存储地址空间与 <em>uniform</em> 空间类似。存储变量需要 @group 和 @binding 注释，并且在着色器程序中不能分配初始值。存储变量默认情况下是只读的，但也可以是读写的。（具有读写访问权限的存储变量可以用于片段和计算着色器，但不能用于顶点着色器。）使用读写访问权限的存储变量使用 <code>var&lt;storage,read_write&gt;</code> 声明。</li>
<li><strong>workgroup</strong> 地址空间 — 这个地址空间只能在计算着色器中使用，稍后将介绍。</li>
</ul>
<p>Uniform 和 storage 变量的值来自绑定组。程序的 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 端使用缓冲区、绑定组和绑定组布局（<a href="../s1/#913-渲染管线">9.1.3小节</a>）提供它们的值。有一些特定要求：对于 uniform 变量，device.createBuffer() 中缓冲区的 usage 属性必须包含 GPUBufferUsage.UNIFORM，绑定组布局中的缓冲区的 type 属性必须设置为 "uniform"（这是默认值）。在绑定组本身，每个条目的 offset 属性必须是 256 的倍数。这是对齐规则的一个示例。例如，如果有两个 uniform 变量在着色器程序中：</p>
<div class="highlight"><pre><span></span><code><span class="nd">@group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nd">@binding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">var</span><span class="o">&lt;</span><span class="n">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f32</span><span class="p">;</span>
<span class="nd">@group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nd">@binding</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">var</span><span class="o">&lt;</span><span class="n">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f32</span><span class="p">;</span>
</code></pre></div>
<p>如果使用一个缓冲区来保存两个变量，那么缓冲区必须至少有 300 字节，绑定组可能是这样的：</p>
<div class="highlight"><pre><span></span><code><span class="nx">bindGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">createBindGroup</span><span class="p">({</span>
<span class="w">    </span><span class="nx">layout</span><span class="o">:</span><span class="w"> </span><span class="nx">bindGroupLayout</span><span class="p">,</span>
<span class="w">    </span><span class="nx">entries</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">        </span><span class="nx">binding</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">buffer</span><span class="o">:</span><span class="w"> </span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nx">binding</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">        </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">buffer</span><span class="o">:</span><span class="w"> </span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">256</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}]</span>
<span class="p">});</span>
</code></pre></div>
<p>对于存储变量，对齐规则是相同的。创建缓冲区时的用法必须包含 GPUBufferUsage.STORAGE。在绑定组布局中，类型必须是 "read-only-storage" 用于默认的只读存储变量，或者 "storage" 用于读写存储变量。</p>
<hr />
<p>In addition to the alignment rule for uniform and storage bindings, <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr> has alignment rules for its data types. The alignment value for a data type can be 4, 8, or 16. An alignment is always a power of 2. (Alignment 2 is also possible for a 16-bit floating point type that can only be used if a language extension is enabled; 16-bit floats are not covered in this textbook.) If the alignment for a data type is N, then the memory address of any value of that type must be a multiple of N. When the value is part of a data structure, the offset of that value from the start of the data structure must be a multiple of N.</p>
<p>Ordinarily, you will only need to worry about alignment for data structures in the uniform or storage address space. But in that case, knowing the alignment is essential, since you have to take it into account on the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side when writing data to buffers.</p>
<p>The basic (scalar) data types in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> are 4-byte integers and floats, which have alignment 4. <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has vectors of 2, 3, and 4 scalar values, which have size 8, 12, and 16. The alignments for 2-vectors and 4-vectors are 8 and 16, as you might expect. But the size of a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> is 12, which is not a legal alignment, so the alignment for 3-vectors is 16. That is, the address in memory of the first byte of a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> must be a multiple of 16.</p>
<p>For an array data structure, the elements of the array must be aligned within the array. This means that in an array of 3-vectors, each element must start at a multiple of 16 bytes from the start of the array. Since a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> such as a vec3f only occupies 12 bytes, four extra bytes of padding must be inserted after each element. No padding is needed in an array of 2-vectors or 4-vectors. So, an array of vec3f takes up just as much memory as an array of vec4f with the same number of elements. The alignment of an array type is equal to the alignment of its elements.</p>
<p>For structs, each element of the struct must satisfy the alignment rule for the data type of that element, which might require padding between some elements. The alignment for the struct itself is the maximum of the alignments of its elements. And the size of the struct must be a multiple of its alignment, which might require some padding at the end.</p>
<p>Let's look at an example that might appear in a <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> program that does 3D graphics (see the <a href="../s4/">next section</a>). Some of the syntax has not been covered yet, but you should be able to follow it:</p>
<div class="highlight"><pre><span></span><code><span class="nx">struct</span><span class="w"> </span><span class="nx">LightProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">position</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">,</span><span class="w">      </span><span class="c1">//  size 16,  offset  0</span>
<span class="w">    </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w">         </span><span class="c1">//  size 12,  offset 16 bytes (4 floats)</span>
<span class="w">    </span><span class="nx">spotDirection</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w">  </span><span class="c1">//  size 12,  offset 32 bytes (8 floats)</span>
<span class="w">    </span><span class="nx">spotCosineCutoff</span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">,</span><span class="w"> </span><span class="c1">//  size  4,  offset 44 bytes (11 floats)</span>
<span class="w">    </span><span class="nx">spotExponent</span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">,</span><span class="w">     </span><span class="c1">//  size  4,  offset 48 bytes (12 floats)</span>
<span class="w">    </span><span class="nx">enabled</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="w">          </span><span class="c1">//  size  4,  offset 52 bytes (13 floats)</span>
<span class="p">}</span>

<span class="err">@</span><span class="nx">group</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="err">@</span><span class="nx">binding</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="kd">var</span><span class="o">&lt;</span><span class="nx">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">lights</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">LightProperties</span><span class="p">,</span><span class="mf">4</span><span class="o">&gt;</span>
</code></pre></div>
<p>The first vec3f in the struct, color, ends with byte number 27, but the next vec3f, spotDirection, can't start at byte 28 because the alignment rule says that it must start at a multiple of 16. So, four bytes of padding are added. Then, spotDirection starts at byte number 32 and ends with byte number 43. The next element is the 32-bit float spotCosineCutoff, with alignment 4, and it can start at the next byte number, 44. Note that there is no padding after spotDirection. The alignment rule for vec3f does <strong>not</strong> say that every vec3f is followed by four bytes of padding. Alignment rules are restrictions on where a variable can start. (Yes, this example did trip me up the first time I tried it.)</p>
<p>The array in the example, lights, is an array of four structs of type LightProperties. The alignment for a LightProperties struct is 16 (the maximum of the alignments of its elements). The size, which must be a multiple of the alignment, is 64, with 8 bytes of padding at the end. The size of the array is therefore 256 bytes, or 64 32-bit floats. On the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side, data for the <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> array could come from a <strong><em>Float32Array</em></strong> of length 64. When storing values into that <strong><em>Float32Array</em></strong>, you would have to be very careful to take the data alignments into account.</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> also has data types for matrices of floating point values. A <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> is essentially an array of column vectors, and it follows the same alignment rules. In particular, a <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> with 3 rows is an array of vec3f, with four bytes of padding after each column. This will become important when we work with normal transformation metrics in 3D graphics.</p>
</div>
<div class="tabbed-block">
<p>To avoid a lot of frustration when working with <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> data values, you will need to understand two aspects of <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> that are not common in other programming languages: address spaces and alignment.</p>
<p>Memory that is accessible to a <abbr title="Graphics Processing Unit, a computer hardware component that performs graphical computations that create and manipulate images. Operations such as drawing a line on the screen or rendering a 3D image are done in the GPU, which is optimized to perform such operations very quickly.">GPU</abbr> is divided into address spaces, which have different accessibility rules and which might be physically accessed in different ways. Every variable lives in a particular address space, and that address space is part of the variable's type. For example, we have seen how a global variable can be declared using var<code>&lt;uniform&gt;</code>. That variable lives in the <em>uniform</em> address space, which holds values that generally come from the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side of the program. Here are the available address spaces:</p>
<ul>
<li><strong>function</strong> address space — The <em>function</em> address space is for local variables and parameters in functions. It is basically the function call <abbr title="A data structure with the operations push() and pop(). Pushing an item onto a stack just adds that item to the stack. Popping from the stack will remove and return the item that was most recently pushed onto the stack.">stack</abbr> for a single processor in the <abbr title="Graphics Processing Unit, a computer hardware component that performs graphical computations that create and manipulate images. Operations such as drawing a line on the screen or rendering a 3D image are done in the GPU, which is optimized to perform such operations very quickly.">GPU</abbr>, which is stored in the dedicated local memory for that processor. Local variables can be declared using var<code>&lt;function&gt;</code>, but the <em>function</em> address space is the only possibility for local variables, and they can declared using simply var.</li>
<li><strong>private</strong> address space — The <em>private</em> address space is used for global variables in <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> programs, but each <abbr title="Graphics Processing Unit, a computer hardware component that performs graphical computations that create and manipulate images. Operations such as drawing a line on the screen or rendering a 3D image are done in the GPU, which is optimized to perform such operations very quickly.">GPU</abbr> processor has its own copy of the variable, stored in the dedicated local memory for that processor. As a global variable, a variable declared using var<code>&lt;private&gt;</code> can be used in any function in the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> program, but a given copy of the variable is only shared by function calls in the same invocation of the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr>.</li>
<li><strong>uniform</strong> address space — The <em>uniform</em> address space holds global variables that are shared by all <abbr title="Graphics Processing Unit, a computer hardware component that performs graphical computations that create and manipulate images. Operations such as drawing a line on the screen or rendering a 3D image are done in the GPU, which is optimized to perform such operations very quickly.">GPU</abbr> processors. <em>Uniform</em> variables are read-only. A variable declaration using var<code>&lt;uniform&gt;</code> cannot include an initial value for the variable, and a <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> cannot assign a new value to the variable. The values in a <em>uniform</em> variable are "resources" that come from a bind group, and every <em>uniform</em> variable declaration must have @group and @binding annotations that are used to specify the source of the resource.</li>
<li><strong>storage</strong> address space — The storage address space is similar to the <em>uniform</em> space. Storage variables require @group and @binding annotations and cannot be assigned an initial value in the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> program. Storage variables by default are read-only, but read-write access is also possible. (A storage variable with read-write access can be used in fragment and compute shaders, but not in <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> shaders.) A storage variable with read-write access is declared using var<code>&lt;storage,read_write&gt;</code>.</li>
<li><strong>workgroup</strong> address space — This address space can only be used in compute shaders and will be covered later.</li>
</ul>
<p>Values for uniform and storage variables come from bind groups. The <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side of the program provides their values using buffers, bind groups, and bind group layouts (<a href="../s1/#913-渲染管线">Subsection 9.1.3</a>). There are certain requirements: For a <abbr title="Variables that represent input to a shader program in a programmable graphics pipeline. A uniform variable has the same value at every vertex and at every pixel of a primitive.">uniform variable</abbr>, the usage property of the buffer in device.createBuffer() must include GPUBufferUsage.UNIFORM, and the buffer in the bind group layout must have its type property set to "uniform" (which is the default). In the bind group itself, the offset property for each entry must be a multiple of 256. This is an example of an alignment rule. For example, if there are two uniform variables in the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> program</p>
<div class="highlight"><pre><span></span><code><span class="nd">@group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nd">@binding</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="n">var</span><span class="o">&lt;</span><span class="n">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f32</span><span class="p">;</span>
<span class="nd">@group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="nd">@binding</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="n">var</span><span class="o">&lt;</span><span class="n">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">f32</span><span class="p">;</span>
</code></pre></div>
<p>and if one buffer is used to hold both variables, then the buffer must be at least 300 bytes and the bind group would be something like</p>
<div class="highlight"><pre><span></span><code><span class="nx">bindGroup</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">device</span><span class="p">.</span><span class="nx">createBindGroup</span><span class="p">({</span>
<span class="nx">layout</span><span class="o">:</span><span class="w"> </span><span class="nx">bindGroupLayout</span><span class="p">,</span>
<span class="nx">entries</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
<span class="w">    </span><span class="nx">binding</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
<span class="w">    </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buffer</span><span class="o">:</span><span class="w"> </span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">},</span>
<span class="p">{</span>
<span class="w">    </span><span class="nx">binding</span><span class="o">:</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span>
<span class="w">    </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">buffer</span><span class="o">:</span><span class="w"> </span><span class="nx">buffer</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="mf">256</span><span class="p">,</span><span class="w"> </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}]</span>
<span class="p">});</span>
</code></pre></div>
<p>For storage variables the alignment rule is the same. The usage when creating the buffer must include GPUBufferUsage.STORAGE. And the type in the bind group layout must be "read-only-storage" for the default read-only storage variables, or "storage" for read-write storage variables.</p>
<hr />
<p>In addition to the alignment rule for uniform and storage bindings, <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr> has alignment rules for its data types. The alignment value for a data type can be 4, 8, or 16. An alignment is always a power of 2. (Alignment 2 is also possible for a 16-bit floating point type that can only be used if a language extension is enabled; 16-bit floats are not covered in this textbook.) If the alignment for a data type is N, then the memory address of any value of that type must be a multiple of N. When the value is part of a data structure, the offset of that value from the start of the data structure must be a multiple of N.</p>
<p>Ordinarily, you will only need to worry about alignment for data structures in the uniform or storage address space. But in that case, knowing the alignment is essential, since you have to take it into account on the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side when writing data to buffers.</p>
<p>The basic (scalar) data types in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> are 4-byte integers and floats, which have alignment 4. <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has vectors of 2, 3, and 4 scalar values, which have size 8, 12, and 16. The alignments for 2-vectors and 4-vectors are 8 and 16, as you might expect. But the size of a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> is 12, which is not a legal alignment, so the alignment for 3-vectors is 16. That is, the address in memory of the first byte of a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> must be a multiple of 16.</p>
<p>For an array data structure, the elements of the array must be aligned within the array. This means that in an array of 3-vectors, each element must start at a multiple of 16 bytes from the start of the array. Since a 3-<abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> such as a vec3f only occupies 12 bytes, four extra bytes of padding must be inserted after each element. No padding is needed in an array of 2-vectors or 4-vectors. So, an array of vec3f takes up just as much memory as an array of vec4f with the same number of elements. The alignment of an array type is equal to the alignment of its elements.</p>
<p>For structs, each element of the struct must satisfy the alignment rule for the data type of that element, which might require padding between some elements. The alignment for the struct itself is the maximum of the alignments of its elements. And the size of the struct must be a multiple of its alignment, which might require some padding at the end.</p>
<p>Let's look at an example that might appear in a <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> program that does 3D graphics (see the <a href="../s4/">next section</a>). Some of the syntax has not been covered yet, but you should be able to follow it:</p>
<div class="highlight"><pre><span></span><code><span class="nx">struct</span><span class="w"> </span><span class="nx">LightProperties</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">position</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">,</span><span class="w">      </span><span class="c1">//  size 16,  offset  0</span>
<span class="w">    </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w">         </span><span class="c1">//  size 12,  offset 16 bytes (4 floats)</span>
<span class="w">    </span><span class="nx">spotDirection</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w">  </span><span class="c1">//  size 12,  offset 32 bytes (8 floats)</span>
<span class="w">    </span><span class="nx">spotCosineCutoff</span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">,</span><span class="w"> </span><span class="c1">//  size  4,  offset 44 bytes (11 floats)</span>
<span class="w">    </span><span class="nx">spotExponent</span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">,</span><span class="w">     </span><span class="c1">//  size  4,  offset 48 bytes (12 floats)</span>
<span class="w">    </span><span class="nx">enabled</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="w">          </span><span class="c1">//  size  4,  offset 52 bytes (13 floats)</span>
<span class="p">}</span>

<span class="err">@</span><span class="nx">group</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="err">@</span><span class="nx">binding</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="kd">var</span><span class="o">&lt;</span><span class="nx">uniform</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">lights</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">LightProperties</span><span class="p">,</span><span class="mf">4</span><span class="o">&gt;</span>
</code></pre></div>
<p>The first vec3f in the struct, color, ends with byte number 27, but the next vec3f, spotDirection, can't start at byte 28 because the alignment rule says that it must start at a multiple of 16. So, four bytes of padding are added. Then, spotDirection starts at byte number 32 and ends with byte number 43. The next element is the 32-bit float spotCosineCutoff, with alignment 4, and it can start at the next byte number, 44. Note that there is no padding after spotDirection. The alignment rule for vec3f does <strong>not</strong> say that every vec3f is followed by four bytes of padding. Alignment rules are restrictions on where a variable can start. (Yes, this example did trip me up the first time I tried it.)</p>
<p>The array in the example, lights, is an array of four structs of type LightProperties. The alignment for a LightProperties struct is 16 (the maximum of the alignments of its elements). The size, which must be a multiple of the alignment, is 64, with 8 bytes of padding at the end. The size of the array is therefore 256 bytes, or 64 32-bit floats. On the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side, data for the <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> array could come from a <strong><em>Float32Array</em></strong> of length 64. When storing values into that <strong><em>Float32Array</em></strong>, you would have to be very careful to take the data alignments into account.</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> also has data types for matrices of floating point values. A <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> is essentially an array of column vectors, and it follows the same alignment rules. In particular, a <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> with 3 rows is an array of vec3f, with four bytes of padding after each column. This will become important when we work with normal transformation metrics in 3D graphics.</p>
</div>
</div>
</div>
<h2 id="932-数据类型">9.3.2 数据类型<a class="headerlink" href="#932-数据类型" title="Permanent link">&para;</a></h2>
<p><strong>Data Types</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>WGSL中的基本或“标量”类型包括布尔类型bool，其值为true和false；32位无符号整型类型u32；32位有符号整型类型i32；以及32位浮点类型f32。特别要注意的是，没有8位、16位或64位的数值类型（尽管16位浮点类型f16作为语言扩展是可用的）。</p>
<p>布尔类型bool不是“宿主共享”的，这意味着bool类型的变量不能位于存储或uniform地址空间，也不能从JavaScript端获取其值。这也意味着任何包含bool的的数据结构都不能位于存储或uniform地址空间。</p>
<p>整型字面量可以以通常的十进制形式书写，或者以十六进制形式书写，以0x或0X开头。u32类型的整型字面量以"u"后缀书写，i32类型的以"i"后缀书写。一些例子：17i, 0u, 0xfadeu, 0X7Fi。没有后缀的整型字面量也是可能的；它们被认为是“抽象整数”。奇怪的是，抽象整数可以自动转换为u32、i32或f32，尽管WGSL不会在常规类型之间进行自动转换。因此，如果N是f32类型的变量，那么表达式N+2是合法的，抽象整数2被自动转换为f32。但是表达式N+2u是非法的，因为u32 2u不会自动转换为f32。抽象整数的主要目的似乎是使得能够以更自然的方式书写涉及常量的表达式。</p>
<p>浮点字面量包括小数点、指数或"f"后缀。带有"f"后缀的浮点字面量类型为f32。没有后缀的，它是“抽象浮点数”，可以自动转换为f32类型。例子包括：.0, 17.0, 42f, 0.03e+10f。（也有十六进制浮点字面量，但这里不涉及。）</p>
<p>WGSL具有具有2、3和4个元素的向量类型。向量中的元素可以是任何标量类型：bool、u32、i32或f32。向量类型有官方名称，如<code>vec3&lt;f32&gt;</code>表示包含三个f32值的向量，<code>vec4&lt;bool&gt;</code>表示包含四个bool的向量。但是数值向量的类型名称有更常用的“别名”：vec4f是<code>vec4&lt;f32&gt;</code>的别名，vec2i是<code>vec2&lt;i32&gt;</code>的别名，vec3u是<code>vec3&lt;u32&gt;</code>的别名。</p>
<p>向量类似于数组，可以使用数组表示法引用向量的元素。例如，如果V是vec4f，那么它的元素是V[0]、V[1]、V[2]和V[3]。元素也可以使用<em>swizzlers</em>表示为V.x、V.y、V.z和V.w。通过在点后面使用多个字母，可以构造由V的选定元素组成的向量。例如，V.yx是一个包含V的前两个元素并以相反顺序排列的vec4f，V.zzzz是由V的第三个元素的四份副本组成的vec4f。字母rgba也可以代替xyzw。（这与GLSL类似，<a href="../../c6/s3/#631-基本类型">6.3.1小节</a>。）</p>
<p>WGSL还有矩阵类型，但只有用于浮点值的矩阵。有2x2、3x3和4x4矩阵的N-by-M类型，官方名称如<code>mat3x2&lt;f32&gt;</code>和<code>mat4x4&lt;f32&gt;</code>。但是这些类型也有更简单的别名，如mat3x2f和mat4x4f。</p>
<p>数组的元素以列主序存储：第一列的元素，然后是第二列的元素，依此类推。每一列是一个向量，列向量可以使用数组表示法访问。例如，如果M是mat4x4f，那么M[1]是M的第二列的vec4f，M[1][0]是该向量的第一个元素。</p>
<p>对于构建数据结构，WGSL有数组和结构体。具有元素类型T和长度N的数组的数据类型是<code>array&lt;T,N&gt;</code>。数组长度必须是常量。没有长度的数组类型也是可能的，但只在存储地址空间中。像通常一样引用数组元素；例如，<code>A[i]</code>。</p>
<p>结构体数据类型包含成员声明列表，可以是不同类型的。参见上面LightProperties类型的示例定义。成员可以是标量、<abbr title="向量空间中的元素。向量空间的元素可以相加，并且可以乘以常数。对于计算机图形，向量只是包含两个、三个或四个数字的列表或数组。在这个意义上，向量通常用于表示2D、3D或4D空间中的点。然而，准确地说，向量表示具有长度和方向的数量；以这种方式使用的向量可以被可视化为箭头。">向量</abbr>、<abbr title="数字的矩形数组。矩阵可以表示为二维数组，数字按行和列排列。一个N×N矩阵表示从N维空间到自身的线性变换。">矩阵</abbr>、数组或结构体。使用通常的点表示法访问成员。例如，如果L是LightProperties类型，那么L.color是L的颜色成员。我将指出，结构体的各个成员可以有注解。例如，</p>
<div class="highlight"><pre><span></span><code><span class="nx">struct</span><span class="w"> </span><span class="nx">VertexOutput</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="err">@</span><span class="nx">builtin</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">,</span>
<span class="w">    </span><span class="err">@</span><span class="nx">location</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span>
<span class="p">}</span>
</code></pre></div>
<p>WGSL有指针类型，但据我所知，它们只能用于函数定义中的形式参数类型。指针类型名称采用<code>ptr&lt;A,T&gt;</code>的形式，其中A是地址空间名称，T是类型；例如：<code>ptr&lt;function,i32&gt;</code>或<code>ptr&lt;private,array&lt;f32,5&gt;&gt;</code>。类型<code>ptr&lt;A,T&gt;</code>的指针只能指向地址空间A中类型T的值。</p>
<p>如果P是指针，那么*P是它指向的值。如果V是变量，那么&amp;V是指向V的指针。指针类型可用于实现传递给函数的引用。例如，</p>
<div class="highlight"><pre><span></span><code><span class="nx">fn</span><span class="w"> </span><span class="nx">array5sum</span><span class="p">(</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ptr</span><span class="o">&lt;</span><span class="kd">function</span><span class="p">,</span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">f32</span><span class="p">,</span><span class="mf">5</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">f32</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">A</span><span class="p">)[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sum</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>注意使用*A来命名A指向的数组。在<code>(*A)[i]</code>中使用括号是由优先级规则要求的。这个函数可以这样调用：array5sum(&amp;Nums)，其中Nums是函数地址空间中的<code>array&lt;f32,5&gt;</code>类型的变量。（也就是说，Nums必须是局部变量。）</p>
<p>标量类型、<abbr title="向量空间中的元素。向量空间的元素可以相加，并且可以乘以常数。对于计算机图形，向量只是包含两个、三个或四个数字的列表或数组。在这个意义上，向量通常用于表示2D、3D或4D空间中的点。然而，准确地说，向量表示具有长度和方向的数量；以这种方式使用的向量可以被可视化为箭头。">向量</abbr>、<abbr title="数字的矩形数组。矩阵可以表示为二维数组，数字按行和列排列。一个N×N矩阵表示从N维空间到自身的线性变换。">矩阵</abbr>、数组和结构体都是可构造的。也就是说，可以从适当的值列表构造给定类型的值。符号看起来像函数调用，函数名称是类型的名称。这里有一些例子：</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">u32</span><span class="p">(</span><span class="mf">23.67</span><span class="nx">f</span><span class="p">);</span><span class="w">           </span><span class="c1">// a是23u</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f32</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="w">                </span><span class="c1">// b是23.0f</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w">        </span><span class="c1">// 抽象整数1,2,3被转换为f32</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">xy</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// c.xy向vec4f贡献了两个值</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mat2x2f</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">   </span><span class="c1">// 构造2x2单位矩阵</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mat3x3f</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">);</span><span class="w">      </span><span class="c1">// f的每一列是vec3f c</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">u32</span><span class="p">,</span><span class="mf">4</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// 构造长度为4的数组</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MyStruct</span><span class="p">(</span><span class="w"> </span><span class="mf">17</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="mf">42</span><span class="nx">f</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// MyStruct是由u32和f32组成的结构体</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4i</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span><span class="w">              </span><span class="c1">// 与vec4i(2,2,2,2)相同；2被重复</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The basic, or "scalar," types in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> include the boolean type, bool, with values true and false; the 32-bit unsigned integer type, u32; the 32-bit signed integer type, i32; and the 32-bit floating point type, f32. Note in particular that there are no 8-bit, 16-bit, or 64-bit numeric types (although the 16-bit floating point type, f16, is available as a language extension).</p>
<p>The bool type is not "host sharable," which means that a variable of type bool cannot be in the storage or uniform address space, and it can't get its value from the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> side. This also means that any data structure that includes a bool cannot be in the storage or uniform address space.</p>
<p>Literals of integer type can be written in the usual decimal form, or in hexadecimal form with a leading 0x or 0X. An integer literal of type u32 is written with a "u" suffix, and one of type i32 with an "i" suffix. Some examples: 17i, 0u, 0xfadeu, 0X7Fi. Integer literals without suffixes are also possible; they are considered to be "abstract integers." Curiously, an abstract integer can be automatically converted into a u32, i32, or f32, even though <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> will not do automatic conversions between the regular types. So, if N is a variable of type f32, then the expression N+2 is legal, with the abstract integer 2 being automatically converted into an f32. But the expression N+2u is illegal because the u32 2u is not automatically converted to f32. The main point of abstract integers seems to be to make it possible to write expressions involving constants in a more natural way.</p>
<p>Floating point literals include either a decimal point, or an exponent, or an "f" suffix." A floating point literal with an "f" suffix has type f32. Without the suffix, it is an "abstract float," which can be automatically converted to type f32. Examples include: .0, 17.0, 42f, 0.03e+10f. (There are also hexadecimal floating point literals, but they are not covered here.)</p>
<hr />
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> types with 2, 3, and 4 elements. The elements in a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> can be any scalar type: bool, u32, i32, or f32. The <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> types have official names like <code>vec3&lt;f32&gt;</code> for a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> of three f32 values and <code>vec4&lt;bool&gt;</code> for a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> of four bools. But the type names for numeric vectors have "aliases" that are more commonly used instead of the official names: vec4f is an alias for <code>vec4&lt;f32&gt;</code>, vec2i is an alias for <code>vec2&lt;i32&gt;</code>, and vec3u is an alias for <code>vec3&lt;u32&gt;</code>.</p>
<p>Vectors are similar to arrays, and the elements of a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> can be referred to using array notation. For example, if V is a vec4f, then its elements are V[0], V[1], V[2], and V[3]. The elements can also be referred to using <em>swizzlers</em> as V.x, V.y, V.z, and V.w. By using multiple letters after the dot, you can construct vectors made up of selected elements of V. For example, V.yx is a vec4f containing the first two elements of V in reversed order, and V.zzzz is a vec4f made up of four copies of the third element of V. The letters rgba can also be used instead of xyzw. (All this is similar to <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr>, <a href="../../c6/s3/#631-基本类型">Subsection 6.3.1</a>.)</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> also has <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> types, but only for matrices of floating point values. There are types for N-by-M matrices for all a N and M equal to 2, 3, or 4, with official names like <code>mat3x2&lt;f32&gt;</code> and <code>mat4x4&lt;f32&gt;</code>. But again these types have simpler aliases like mat3x2f and mat4x4f.</p>
<p>The elements of an array are stored in <abbr title="Column-by-column ordering of the elements of a two-dimensional matrix; that is, an ordering that starts with the elements in the first column, followed by the elements in the second column, and so on. Column-major order is used for matrices in OpenGL and GLSL.">column-major order</abbr>: the elements of the first column, followed by the elements of the second column, and so on. Each column is a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>, and the column vectors can be accessed using array notation. For example, if M is a mat4x4f, then M[1] is the vec4f that is the second column of M, and M[1][0] is the first element of that <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>.</p>
<hr />
<p>For building data structures, <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has arrays and structs. The data type for an array with element type T and length N is <code>array&lt;T,N&gt;</code>. The array length must be a constant. Array types without a length are also possible, but only in the storage address space. Array elements are referred to as usual; for example, <code>A[i]</code>.</p>
<p>A struct data type contains a list of member declarations, which can be of different types. See, for example, the definition of the LightProperties type, above. A member can be a scalar, a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>, a <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr>, an array, or a struct. Members are accessed using the usual dot notation. For example, if L is of type LightProperties, then L.color is the color member of L. I will note that the individual members of a struct can have annotations. For example,</p>
<div class="highlight"><pre><span></span><code><span class="nx">struct</span><span class="w"> </span><span class="nx">VertexOutput</span><span class="w"> </span><span class="p">{</span>
<span class="err">@</span><span class="nx">builtin</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span><span class="w"> </span><span class="nx">position</span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">,</span>
<span class="err">@</span><span class="nx">location</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has pointer types, but as far as I can tell, they can only be used for the types of formal parameters in function definitions. A pointer type name takes the form <code>ptr&lt;A,T&gt;</code>, where A is an address space name and T is a type; for example:<code>ptr&lt;function,i32&gt;</code> or <code>ptr&lt;private,array&lt;f32,5&gt;&gt;</code>. A pointer of type <code>ptr&lt;A,T&gt;</code> can only point to a value of type T in address space A.</p>
<p>If P is a pointer, then *P is the value that it points to. If V is a variable, then &amp;V is a pointer to V. Pointer types can be used to implement pass-by-reference to a function. For example,</p>
<div class="highlight"><pre><span></span><code><span class="nx">fn</span><span class="w"> </span><span class="nx">array5sum</span><span class="p">(</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ptr</span><span class="o">&lt;</span><span class="kd">function</span><span class="p">,</span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">f32</span><span class="p">,</span><span class="mf">5</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">f32</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="nx">A</span><span class="p">)[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">sum</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>Note the use of *A to name the array that A points to. The parentheses in <code>(*A)[i]</code> are required by precedence rules. This function could be called as array5sum(&amp;Nums) where Nums is a variable of type <code>array&lt;f32,5&gt;</code> in the function address space. (That is, Nums must be a local variable.)</p>
<hr />
<p>Scalar types, vectors, matrices, arrays, and structs are constructible. That is, a value of the given type can be constructed from an appropriate list of values. The notation looks like a function call, with the function name being the name of the type. Here are some examples:</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">u32</span><span class="p">(</span><span class="mf">23.67</span><span class="nx">f</span><span class="p">);</span><span class="w">           </span><span class="c1">// a is 23u</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">f32</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="w">                </span><span class="c1">// b is 23.0f</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="mf">3</span><span class="p">);</span><span class="w">        </span><span class="c1">// the abstract ints 1,2,3 are converted to f32</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">d</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">xy</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">     </span><span class="c1">// c.xy contributes two values to the vec4f</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">e</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mat2x2f</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span><span class="w">   </span><span class="c1">// constructs the 2-by-2 identity matrix</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">mat3x3f</span><span class="p">(</span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">);</span><span class="w">      </span><span class="c1">// each column of f is the vec3f c</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">g</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">u32</span><span class="p">,</span><span class="mf">4</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">);</span><span class="w"> </span><span class="c1">// construct an array of length 4</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">h</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">MyStruct</span><span class="p">(</span><span class="w"> </span><span class="mf">17</span><span class="nx">u</span><span class="p">,</span><span class="w"> </span><span class="mf">42</span><span class="nx">f</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// MyStruct is a struct made of a u32 and an f32</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4i</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span><span class="w">              </span><span class="c1">// Same as vec4i(2,2,2,2); the 2 is repeated</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="933-声明和注解">9.3.3 声明和注解<a class="headerlink" href="#933-声明和注解" title="Permanent link">&para;</a></h2>
<p><strong>Declarations and Annotations</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>我们已经看到如何使用 <code>var&lt;A&gt;</code> 声明变量，其中 A 是地址空间。函数中的局部变量可以使用 <code>var&lt;function&gt;</code> 或者简单地使用 var 来声明。对于全局变量，需要一个地址空间 —— 私有的、uniform、存储的或工作组的（但是与纹理相关的全局变量遵循不同的规则）。</p>
<p>可以在声明中通过在变量名后跟一个冒号然后是类型名称来指定变量的类型。例如：</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="o">&lt;</span><span class="kr">private</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">;</span>
</code></pre></div>
<p>在函数或私有地址空间中的变量声明可以包含变量的初始值。初始值可以是一个常量、一个变量或一个表达式。当声明中包含初始值时，通常不需要指定变量的类型，因为 <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr> 编译器可以从初始值确定类型。当使用抽象整数初始化变量且未指定类型时，类型被视为 i32。</p>
<p>在函数体中，可以使用 let 而不是 var 来声明一个标识符。结果是一个命名值而不是变量。let 声明必须包含初始值。初始化后值不能更改。声明中可以可选地包含类型，但通常不必要。不能指定地址空间。使用 let 明确表示你不期望值会改变，并使意外更改值变得不可能。</p>
<p>也可以使用 const 声明命名值，但是在 const 声明中的初始值必须是已知于编译时的常量。初始值可以作为表达式给出，只要表达式只包含常量。虽然 let 只能在函数中使用，const 声明可以用于任何地方。</p>
<p>一个声明只能声明一个标识符。所以像 "<code>var a = 1, b = 2;</code>" 这样的东西是不合法的。这适用于 const 和 let，以及 var。</p>
<hr />
<p>我们已经看到，像 @location(0) 这样的注解可以用于变量声明、函数定义、函数形式参数和函数的返回类型。（<abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 文档称它们为 "<abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attributes</abbr>"，但我更倾向于保留 "<abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr>" 这个术语用于顶点属性。）这本教科书只涵盖了最常见的注解。我们在前面的章节中遇到了其中一些，在讨论计算着色器时，稍后会看到更多。常见的注解包括：</p>
<ul>
<li>group(N) 和 @binding(M)，N 和 M 是整数，用于 uniform 和 storage 地址空间的 var 声明中，指定资源的来源。关联是通过绑定组布局指定的。见 <a href="../s1/#913-渲染管线">9.1.3小节</a>。</li>
<li>@<abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr>、@fragment 和 @compute 用于函数定义，指定该函数可以用作顶点、片段或计算着色器的入口点函数。见 <a href="../s1/#912-着色器模块">9.1.2小节</a>。</li>
<li>@location(N)，N 是一个整数，可以用于顶点着色器和片段着色器入口点函数的输入和输出。它可以应用于它们的形式参数和返回类型，以及用于指定它们的正式参数和返回类型的结构体成员。含义取决于上下文。在顶点着色器入口点的输入上，它指定了顶点缓冲区中输入的来源 (<a href="../s1/#916-多个顶点输入">9.1.6小节</a>)。在片段着色器入口点函数的返回类型上，它指定了该输出的目标颜色附件 (<a href="../s1/#913-渲染管线">9.1.3小节</a>)。当用于顶点着色器输出或片段着色器输入时，它将顶点着色器的特定输出与片段着色器的相应输入关联起来 (<a href="../s1/#916-多个顶点输入">9.1.6小节</a>)。</li>
<li>@interpolate(flat) 可以应用于顶点着色器入口点函数的输出和片段着色器程序的相应输入。如果它应用于其中一个，那么必须同时应用于两者。通常，片段着色器输入的值是从正在绘制的三角形或线条的所有顶点处的顶点着色器输出值进行插值得到的。@interpolate(flat) 注解关闭了插值；相反，使用第一个顶点的值用于所有片段。这个注解对于整数或布尔值是必需的，也可以应用于浮点值。</li>
<li>@builtin(vertex_index) 和 @builtin(instance_index) 用于顶点着色器入口点函数的输入，以指定正在处理的顶点编号或实例编号。见 <a href="../s2/#924-在着色器中使用索引">9.2.4小节</a>。</li>
<li>@builtin(position) 当用于顶点着色器入口点函数的输出时，指定输出是顶点在裁剪坐标系中的 (x,y,z,w) <abbr title="一种将数值坐标分配给几何点的方法。在二维中，每个点对应一对数字。在三维中，每个点对应一组三个数字。">坐标</abbr>。每个顶点着色器入口点函数都需要有一个带有此注解的输出。当用于片段着色器程序的输入时，它指定输入是正在处理的片段的插值位置，以视口坐标表示。（见 <a href="../s4/#942-坐标系">9.4.2小节</a> 讨论 <abbr title="一种新的 JavaScript 图形 API，类似于 WebGL，但设计用于让网络程序访问现代 GPU 功能，如计算着色器。">WebGPU</abbr> 中的坐标系。）</li>
<li>@builtin(front_facing) 用于片段着色器程序的布尔类型输入。如果正在处理的片段是前向三角形的一部分，则该值将为 true。这在 3D 图形中进行双面照明时可能很有用 (<a href="../../c7/s2/#724-两侧照明">7.2.4小节</a>)。</li>
</ul>
</div>
<div class="tabbed-block">
<p>We have seen how to declare variables using <code>var&lt;A&gt;</code>, where A is an address space. Local variables in functions can be declared using either <code>var&lt;function&gt;</code> or simply var. For global variables, an address space—private, uniform, storage, or workgroup—is required (but <abbr title="Variation in some property from point-to-point on an object. The most common type is image texture. When an image texture is applied to a surface, the surface color varies from point to point.">texture</abbr>-related global variables follow a different rule).</p>
<p>The type of a variable can be specified in a declaration by following the variable name with a colon and then the name of the type. For example</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="o">&lt;</span><span class="kr">private</span><span class="o">&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">f32</span><span class="p">;</span>
</code></pre></div>
<p>The declaration of a variable in the function or private address space can include an initial value for the variable. The initial value can be a constant, a variable, or an expression. When an initial value is included in the declaration, the type of the variable generally does not have to be specified because the <abbr title="OpenGL Shader Language, the programming language that is used to write shader programs for use with OpenGL.">GLSL</abbr> compiler can determine the type from the initial value. When a variable is initialized using an abstract int, and no type is specified, the type is taken to be i32.</p>
<p>In a function body, an identifier can be declared using let instead of var. The result is a named value rather than a variable. A let declaration must include an initial value. The value cannot be changed after initialization. The declaration can optionally include a type, but it is usually not necessary. An address space cannot be specified. Using let makes it clear that you do not expect the value to change and makes it impossible to change the value accidentally.</p>
<p>Named values can also be declared using const, but the initial value in a const declaration must be a constant that is known at compile time. The initial value can be given as an expression, as long as the expression only contains constants. While let can only be used in functions, const declarations can be used anywhere.</p>
<p>A declaration can only declare one identifier. So something like "<code>var a = 1, b = 2;</code>" is not legal. This applies to const and let, as well as to var.</p>
<hr />
<p>We have seen that annotations like @location(0) can be used on variable declarations, function definitions, function formal parameters, and the return type of a function. (The <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> documentation calls them "<abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attributes</abbr>", but I prefer to save the term "<abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr>" for <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attributes</abbr>.) This textbook only covers the most common annotations. We encountered some of them in previous sections, and a few more will come up later when we discuss compute shaders. Common annotations include:</p>
<ul>
<li>group(N) and @binding(M), where N and M are integers, are used on var declarations in the uniform and storage address spaces to specify the source of resource. The association is specified by a bind group layout. See <a href="../s1/#913-渲染管线">Subsection 9.1.3</a>.</li>
<li>@<abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr>, @fragment, and @compute are used on a function definition to specify that that function can be used as the entry point function for a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr>, fragment, or <abbr title="A stage in a GPU pipeline that does purely computational work, rather than participating directly in graphical rendering.">compute shader</abbr>. See <a href="../s1/#912-着色器模块">Subsection 9.1.2</a>.</li>
<li>@location(N), where N is an integer, can be used on inputs and outputs of <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> and <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> entry point functions. It can be applied to their formal parameters and return types and to members of structs that are used to specify the type of their formal parameters and return types. The meaning depends on context. On an input to a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point, it specifies the source of the input in a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> buffer (<a href="../s1/#916-多个顶点输入">Subsection 9.1.6</a>). On the return type of a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> entry point function, it specifies the color attachment that is the destination of that output (<a href="../s1/#913-渲染管线">Subsection 9.1.3</a>.) And when used on a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> output or a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> input, it associates a particular output of the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> with the corresponding input to the <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> (<a href="../s1/#916-多个顶点输入">Subsection 9.1.6</a>).</li>
<li>@interpolate(flat) can be applied to an output from the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point function and the corresponding input to the <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> program. If it is applied to one, it must be applied to both. Usually, the values for a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> input are interpolated from the output values of the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> at all vertices of the triangle or line that is being drawn. The @interpolate(flat) annotation turns off <abbr title="Given values for some quantity at certain reference points, computing a value for that quantity at other points by some kind of averaging applied to the values at the reference points.">interpolation</abbr>; instead, the value from the first <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> is used for all fragments. This annotation is required for values of integer or boolean type and can also be applied to floating point values.</li>
<li>@builtin(vertex_index) and @builtin(instance_index) are used on inputs to a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point function to specify the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> number or instance number that is being processed. See <a href="../s2/#924-在着色器中使用索引">Subsection 9.2.4</a>.</li>
<li>@builtin(position) when used on an output from a <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point function specifies that the output is the (x,y,z,w) coordinates of the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> in the clip <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr>. Every <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point function is required to have an output with this annotation. When used on an input to a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> program, it specifies that the input is the interpolated position of the fragment being processed, in <abbr title="The rectangular area in which the image for 2D or 3D graphics is displayed. The coordinates on the viewport are pixel coordinates, more properly called device coordinates since they are actual physical coordinates on the device where the image is being displayed.">viewport</abbr> coordinates. (See <a href="../s4/#942-坐标系">Subsection 9.4.2</a> for a discussion of <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate systems</abbr> in <abbr title="一种新的 JavaScript 图形 API，类似于 WebGL，但设计用于让网络程序访问现代 GPU 功能，如计算着色器。">WebGPU</abbr>.)</li>
<li>@builtin(front_facing) is used on an input of type bool to a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> program. The value will be true if the fragment that is being processed is part of a front facing triangle. This can be useful, for example, when doing two-sided <abbr title="Using light sources in a 3D scene, so that the appearance of objects in the scene can be computed based on the interaction of light with the objects' material properties.">lighting</abbr> in 3D graphics (<a href="../../c7/s2/#724-两侧照明">Subsection 7.2.4</a>).</li>
</ul>
</div>
</div>
</div>
<h2 id="934-表达式和内置函数">9.3.4 表达式和内置函数<a class="headerlink" href="#934-表达式和内置函数" title="Permanent link">&para;</a></h2>
<p><strong>Expressions and Built-in Functions</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">中文</label><label for="__tabbed_5_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>WGSL包含了所有熟悉的算术、逻辑、位和比较运算符：<code>+, -, *, /, %, &amp;&amp;, ||, !, &amp;, |, ~, ^, &lt;&lt;, &gt;&gt;, ==, !=, &lt;, &gt;, &lt;=, &gt;=</code>。它没有条件运算符<code>?:</code>，但有一个等价的内置函数<code>select(false_case, true_case, boolean)</code>。注意，赋值（<code>=</code>, <code>+=</code> 等）不是运算符；也就是说，<code>A = B</code> 是一个语句，而不是一个表达式，它不像在 C 或 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 中那样有值。</p>
<p>有趣的是，运算符在许多方面被扩展，可以与向量和矩阵一起使用，也可以与标量一起使用。例如，如果 A 是一个 n-by-m <abbr title="数字的矩形数组。矩阵可以表示为二维数组，数字按行和列排列。一个N×N矩阵表示从N维空间到自身的线性变换。">矩阵</abbr>，B 是一个 m-by-r <abbr title="数字的矩形数组。矩阵可以表示为二维数组，数字按行和列排列。一个N×N矩阵表示从N维空间到自身的线性变换。">矩阵</abbr>，那么 <code>A*B</code> 计算 A 和 B 的矩阵乘积。如果 V 是一个包含 m 个浮点数的向量，那么 <code>A*V</code> 是矩阵和向量的线性代数乘积得到的向量。</p>
<p>算术运算符也可以应用于两个相同数值类型的向量。操作是逐分量应用的。也就是说，</p>
<div class="highlight"><pre><span></span><code><span class="nx">vec3f</span><span class="p">(</span><span class="mf">2.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.0</span><span class="nx">f</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">5.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">8.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">9.0</span><span class="nx">f</span><span class="p">)</span>
</code></pre></div>
<p>结果是 <code>vec3f(2.0f/5.0f, 3.0f/8.0f, 7.0f/9.0f)</code>。相同数值类型的数值向量也可以使用比较运算符进行组合。结果是相同长度的布尔向量。</p>
<p>更有趣的是，算术运算符可以应用于向量和标量。然后，操作应用于向量的每个分量：<code>2+vec2f(5,12)</code> 的结果是 <code>vec2f(7,14)</code>，<code>vec4i(2,5,10,15)/2</code> 的结果是 <code>vec4i(1,2,5,7)</code>。</p>
<p>当然，表达式也可以包括对内置函数和用户定义函数的调用。WGSL有许多内置函数。它有数学函数，如 abs、cos、atan、exp、log 和 sqrt（log 是自然对数）。（除了 abs，参数必须是浮点类型。参数可以是标量或向量。当它是向量时，函数是逐分量应用的：<code>sqrt(vec2f(16.0,9.0))</code> 的结果是 <code>vec2f(4.0,3.0)</code>。）</p>
<p>有几个内置函数用于对向量执行线性代数运算，包括：<code>length(v)</code> 计算向量 v 的长度；<code>normalize(v)</code> 计算与 v 指向相同方向的单位向量；<code>dot(v,w)</code> 计算 v 和 w 的点积；<code>cross(v,w)</code> 计算两个 3 维向量的叉积；以及 <code>distance(v,w)</code> 计算 v 和 w 之间的距离。在所有情况下，这些函数只适用于浮点向量。有几个函数执行在计算机图形学中常见的操作：</p>
<ul>
<li><code>clamp(value, min, max)</code> 将值 clamp 限制在 min 到 max 的范围内，即如果 value 在 min 和 max 之间则返回 value，如果 value &lt;= min 则返回 min，如果 value &gt;= max 则返回 max。</li>
<li><code>mix(a, b, blend_factor)</code> 返回 a 和 b 的加权平均值，即返回 <code>(1-blend_factor)*a + blend_factor*b</code>。</li>
<li><code>step(edge, x)</code> 如果 x &lt;= edge 返回 0，如果 x &gt; edge 返回 1。</li>
<li><code>smoothstep(low_edge, high_edge, x)</code> 如果 x &lt; low_edge 返回 0，如果 x &gt; high_edge 返回 1，随着 x 从 low_edge 增加到 high_edge，返回值从 0 平滑增加到 1。</li>
<li><code>reflect(L,N)</code>，其中 L 和 N 是单位向量，计算由法向量 N 反射的向量 L。（见 <a href="../../c4/s1/#414-opengl-11-光照方程">4.1.4小节</a>，只是那个部分的插图中的 L 指向从表面向光源的方向，但 reflect(L,N) 中的 L 指向从光源向表面的方向。）</li>
<li><code>refract(L,N,ior)</code>，其中 L 和 N 是单位向量，ior 是折射率的比值，计算当光线从方向 L 击中具有法向量 N 的表面时的折射向量，该表面分隔了具有不同折射率的区域。</li>
</ul>
</div>
<div class="tabbed-block">
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has all the familiar arithmetic, logical, bitwise, and comparison operators:<code>+, -, *, /, %, &amp;&amp;, ||, !, &amp;, |, ~, ^, &lt;&lt;, &gt;&gt;, ==, !=, &lt;, &gt;, &lt;=, &gt;=</code>. It does not have the conditional ?: operator, but it has an equivalent built-in function, select(false_case,true_case,boolean). Note that assignment (<code>=</code>, <code>+=</code>, etc.) is not an operator; that is, <code>A = B</code> is a statement, not an expression, and it does not have a value like it would in C or <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>.</p>
<p>The interesting thing is that operators are extended in many ways to work with vectors and matrices as well as with scalars. For example, if A is an n-by-m <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> and B is an m-by-r <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr>, then <code>A*B</code> computes the <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> product of A and B. And if V is a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> of m floats, then <code>A*V</code> is the <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> that is the <abbr title="The field of mathematics that studies vector spaces and linear transformations between them. Linear algebra is part of the essential mathematical foundation of computer graphics.">linear algebra</abbr> product of the <abbr title="A rectangular array of numbers. A matrix can be represented as a two-dimensional array, with numbers arranged in rows and columns. An N-by-N matrix represents a linear transformation from N-dimensional space to itself.">matrix</abbr> and the <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>.</p>
<p>The arithmetic operators can be applied to two vectors of the same numeric type. The operation is applied component-wise. That is,</p>
<div class="highlight"><pre><span></span><code><span class="nx">vec3f</span><span class="p">(</span><span class="mf">2.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">7.0</span><span class="nx">f</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">5.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">8.0</span><span class="nx">f</span><span class="p">,</span><span class="w"> </span><span class="mf">9.0</span><span class="nx">f</span><span class="p">)</span>
</code></pre></div>
<p>is <code>vec3f(2.0f/5.0f, 3.0f/8.0f, 7.0f/9.0f)</code>. Numeric vectors of the same numeric type can also be combined using a comparison operator. The result is a bool <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> of the same length.</p>
<p>Even more interesting, the arithmetic operators can be applied to a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> and a scalar. The operation then applies to each component of the <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>: <code>2+vec2f(5,12)</code> is <code>vec2f(7,14)</code>, and <code>vec4i(2,5,10,15)/2</code> is <code>vec4i(1,2,5,7)</code>.</p>
<p>Expressions, of course, can also include calls to functions, both built-in and user-defined. <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> has many built-in functions. It has mathematical functions such as abs, cos, atan, exp, log, and sqrt. (log is the natural logarithm.) Except for abs, the parameter must be of floating point type. The parameter can be either a scalar or a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>. When it is a <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr>, the function is applied component-wise: <code>sqrt(vec2f(16.0,9.0))</code> is <code>vec2f(4.0,3.0)</code>.</p>
<p>There are several built-in functions for doing <abbr title="The field of mathematics that studies vector spaces and linear transformations between them. Linear algebra is part of the essential mathematical foundation of computer graphics.">linear algebra</abbr> operations on vectors, including: length(v) for the length of <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> v; <abbr title="将非零向量除以其长度得到的单位向量的结果，即长度为一的向量。注意，“归一化向量”和“法向量”是两个无关的术语！">normalize</abbr>(v) for a <abbr title="A vector of length one.">unit vector</abbr> pointing in the same direction as v; dot(v,w) for the <abbr title="The dot product of two vectors is the sum of the products of corresponding coordinates. For 3D vectors `v=(x,y,z)` and `w=(a,b,c)`, the dot product of v and w is `x*a+y*b+z*c`. The dot product is equal to the cosine of the angle between the vectors, divided by the product of their lengths.">dot product</abbr> of v and w; cross(v,w) for the <abbr title="A vector product of two 3D vectors. The cross product of v and w is a vector that is perpendicular to both v and w and whose length is equal to the absolute value of the sine of the angle between v and w. If v=(x,y,z) and w=(a,b,c), then their cross product is the vector (yc-zb,za-xc,xb-ya).">cross product</abbr> of two 3-vectors; and distance(v,w) for the distance between v and w. In all cases, these functions only work for vectors of floats. There are several functions that do operations that are common in computer graphics:</p>
<ul>
<li>clamp(value, min, max) clamps value to the range min to max, that is, returns value if value is between min and max, returns min if value &lt;= min, and returns max if value &gt;= max.
mix(a, b, blend_factor) returns the weighted average of a and b, that is, returns (1-blend_factor)<em>a + blend_factor</em>b.</li>
<li>step(edge, x) returns 0 if x &lt;= edge and 1 if x &gt; edge.</li>
<li>smoothstep(low_edge, high_edge, x) returns 0 if x &lt; low_edge, returns 1 if x &gt; high_edge, and the return value increases smoothly from 0 to 1 as x increases from low_edge to high_edge.</li>
<li>reflect(L,N), where L and N are unit vectors, computes the <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> L reflected by a surface with <abbr title="A normal vector to a surface at a point on that surface is a vector that is perpendicular to the surface at that point. Normal vectors to curves are defined similarly. Normal vectors are important for lighting calculations.">normal vector</abbr> N. (See <a href="../../c4/s1/#414-opengl-11-光照方程">Subsection 4.1.4</a>, except that the L in the illustration in that section points from the surface towards the light source, but the L in reflect(L,N) points from the light source towards the surface.)</li>
<li>refract(L,N,ior), where L and N are unit vectors, and ior is the ratio of indices of <abbr title="The bending of light as it passes from one transparent or translucent medium into another.">refraction</abbr>, computes the refracted <abbr title="An element of a vector space. Elements of a vector space can be added and can be multiplied by constants. For computer graphics, a vector is just a list or array containing two, three, or four numbers. Vectors in that sense are often used to represent points in 2D, 3D, or 4D space. Properly, however, a vector represents a quantity that has a length and a direction; a vector used in this way can be visualized as an arrow.">vector</abbr> when light from direction L hits a surface with <abbr title="A normal vector to a surface at a point on that surface is a vector that is perpendicular to the surface at that point. Normal vectors to curves are defined similarly. Normal vectors are important for lighting calculations.">normal vector</abbr> N separating regions with different indices of <abbr title="The bending of light as it passes from one transparent or translucent medium into another.">refraction</abbr>.</li>
</ul>
</div>
</div>
</div>
<h2 id="935-语句和控制">9.3.5 语句和控制<a class="headerlink" href="#935-语句和控制" title="Permanent link">&para;</a></h2>
<p><strong>Statements and Control</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">中文</label><label for="__tabbed_6_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 中的语句在很大程度上与 C 语言中的类似，但存在一些限制和扩展。</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 中的基本语句包括赋值（使用 <code>=</code>）；复合赋值（使用 <code>+=</code>、<code>*=</code> 等）；递增（使用 <code>++</code> 如 <code>x++</code>）；递减（使用 <code>--</code>）；函数调用语句；返回语句；<code>break</code>；<code>continue</code>；以及 <code>discard</code>。递增和递减只能是后缀形式；即允许 <code>x++</code>，但不允许 <code>++x</code>。并且 —— 像赋值语句一样 —— 递增和递减语句不是表达式；也就是说，它们没有值，不能作为更大表达式的一部分。<code>discard</code> 语句只能在片段着色器入口点函数中使用。它阻止片段着色器的输出被写入其目的地。</p>
<p>就控制结构而言，<abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 中的 <code>for</code> 循环、<code>while</code> 循环和 <code>if</code> 语句的形式与 C、Java 和 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 中的形式相同，只不过大括号 <code>{}</code> 始终需要包围循环体和 <code>if</code> 语句内的语句，即使大括号只包围一个单独的语句。<code>break</code> 和 <code>continue</code> 可以在循环中像通常一样使用，但请注意，语句不能有标签，也没有带标签的 <code>break</code> 或 <code>continue</code> 语句。<abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 中还有一种额外的循环语句形式：</p>
<div class="highlight"><pre><span></span><code><span class="nx">loop</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">statements</span>
<span class="p">}</span>
</code></pre></div>
<p>这种循环通过 <code>break</code> 或 <code>return</code> 语句退出。它基本上与 "while(true)" 循环相同。</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 中的 <code>switch</code> 语句与通常的形式有显著变化。可以合并情况（例如 case 1,2,3）。<code>case</code> 后的冒号是可选的。每个 <code>case</code> 中的代码必须用大括号包围。在没有 <code>break</code> 语句的情况下，一个 <code>case</code> 内的代码不会流入下一个 <code>case</code>，因此 <code>break</code> 语句在 <code>case</code> 中是可选的。然而，<code>break</code> 和 <code>return</code> 仍然可以用于提前结束一个 <code>case</code>。必须有一个 <code>default</code> 情况。<code>switch</code> 表达式必须是 i32 或 u32 类型，所有的 <code>case</code> 常量必须类型相同，或者是抽象整数。示例请参见 <a href="../../../en/source/webgpu/indices_in_shader.html">webgpu/indices_in_shader.html</a> 中着色器源代码中的 <code>switch</code> 语句。</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> 没有异常的概念，也没有 <code>try..catch</code> 语句。</p>
</div>
<div class="tabbed-block">
<p>Statements in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> are in large part similar to those in C, but there are some restrictions and extensions.</p>
<p>Basic statements in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> include assignment (using <code>=</code>); compound assignment (using <code>+=</code>, <code>*=</code>, etc.); increment (using <code>++</code> as in <code>x++</code>); decrement (using <code>--</code>); function call statements; return statements; break; continue; and discard. Increment and decrement are postfix only; that is, x++ is allowed, but not <code>++x</code>. And—like assignment statements—increment and decrement statements are not expressions; that is, they don't have a value and cannot be used as part of a larger expression. The discard statement can only be used in a <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> entry point function. It stops the output of the <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> from being written to its destination.</p>
<p>As for control structures, for loops, while loops, and if statements in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> have the same form as in C, Java, and <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, except that braces, { and }, are always required around the body of a loop and around the statements inside an if statement, even if the braces enclose just a single statement. break and continue can be used in loops as usual, but note that statements cannot have labels and there is no labeled break or labeled continue statement. There is an additional looping statement in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> that takes the form</p>
<div class="highlight"><pre><span></span><code><span class="nx">loop</span><span class="w"> </span><span class="p">{</span>
<span class="nx">statements</span>
<span class="p">}</span>
</code></pre></div>
<p>This kind of loop is exited with a break or return statement. It is basically the same as a "while(true)" loop.</p>
<p>The switch statement in <abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> is significantly changed from its usual form. Cases can be combined (case 1,2,3). The colon after a case is optional. The code in each case must be enclosed in braces. There is no fallthrough from one case to the next in the absence of a break statement, so break statements are optional in cases. However, break and return can still be used to end a case early. A default case is required. The switch expression must be of type i32 or u32, and all of the case constants must either be of the same type, or be abstract integers. For an example, see the switch statement in the <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> source code in <a href="../../../en/source/webgpu/indices_in_shader.html">webgpu/indices_in_shader.html</a>.</p>
<p><abbr title="WebGPU 着色器语言，是编写 WebGPU 使用的着色器的编程语言。">WGSL</abbr> does not have the concept of exceptions, and there is no try..catch statement.</p>
</div>
</div>
</div>
<h2 id="936-函数定义">9.3.6 函数定义<a class="headerlink" href="#936-函数定义" title="Permanent link">&para;</a></h2>
<p><strong>Function Definitions</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">中文</label><label for="__tabbed_7_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>我们在 <a href="../s1/">第9.1节</a> 和 <a href="../s2/">第9.2节</a> 中看到了函数定义的例子。这些部分中的所有示例都是带有 @<abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> 或 @fragment 注解的着色器入口点函数。在着色器中定义额外的函数是可能的，然后可以按照通常的方式调用这些函数。但请注意，调用入口点函数是<strong>不合法</strong>的；它们只能由系统作为管线的一部分调用。</p>
<p>我会指出，管线的顶点着色器和片段着色器可以在不同的着色器模块中定义。此外，一个着色器模块可以包含任意数量的着色器入口点。管线使用的入口点函数在管线描述符中指定（见 <a href="../s1/#913-渲染管线">9.1.3小节</a>）。</p>
<p>使用 <code>fn</code> 后跟函数名，然后是形式参数列表，然后是可选的 <code>-&gt;</code> 和返回类型，最后是函数体（必须用大括号括起来）来定义函数。除了入口点函数外，用户定义的函数可以从同一着色器模块的任何位置调用。</p>
<p>函数有一些限制。不允许递归，无论是直接的还是间接的。没有嵌套：函数定义不能在另一个函数定义内部。数组参数必须有指定的大小。参数的指针类型必须在函数或私有命名空间中。函数名不能被重载；也就是说，你不能有两个同名的函数，即使它们有不同的参数列表。（但一些内置函数是重载的。）同样，函数不能与全局变量同名。</p>
<p>为了结束这一节，这里有一些用户定义的函数：</p>
<div class="highlight"><pre><span></span><code><span class="nx">fn</span><span class="w"> </span><span class="nx">invertedColor</span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">vec4f</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 返回反转的颜色</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">color</span><span class="p">.</span><span class="nx">rgb</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">grayify</span><span class="p">(</span><span class="nx">color</span><span class="o">:</span><span class="w"> </span><span class="nx">ptr</span><span class="o">&lt;</span><span class="kd">function</span><span class="p">,</span><span class="w"> </span><span class="nx">vec4f</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 就地修改颜色</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="nx">color</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">gray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.59</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.11</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">a</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">min10</span><span class="p">(</span><span class="nx">A</span><span class="o">:</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">f32</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">f32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 参数按值传递！</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">A</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">min</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">simpleLighting</span><span class="p">(</span><span class="nx">N</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">L</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">diffuse</span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">vec3f</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// N 是单位表面法向量。</span>
<span class="w">    </span><span class="c1">// L 是指向光源的单位向量。</span>
<span class="w">    </span><span class="c1">// V 是指向观察者的单位向量</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="w"> </span><span class="nx">L</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 表面照明的错误面</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">   </span><span class="c1">// 返回零向量（黑色）</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dot</span><span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="w"> </span><span class="nx">L</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nx">reflect</span><span class="p">(</span><span class="nx">L</span><span class="p">,</span><span class="w"> </span><span class="nx">N</span><span class="p">);</span><span class="w">  </span><span class="c1">// 反射光线；</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">dot</span><span class="p">(</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 添加镜面照明</span>
<span class="w">        </span><span class="c1">// 镜面颜色是灰色，镜面指数是 10</span>
<span class="w">        </span><span class="nx">color</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">pow</span><span class="p">(</span><span class="nx">dot</span><span class="p">(</span><span class="nx">R</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="p">),</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">color</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>We have seen examples of function definitions in <a href="../s1/">Section 9.1</a> and <a href="../s2/">Section 9.2</a>. All of the examples in those sections were <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry point functions, annotated with @<abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> or @fragment. It is possible to define additional functions in a <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr>, and those functions can then be called in the usual way. Note however that it is <strong>not</strong> legal to call an entry point function; they can only be called by the system as part of a <abbr title="A sequence of computational stages in a GPU that are applied to incoming data to produce some result. Some of the stages can be programmable shaders, such as vertex shaders, fragment shaders, and compute shaders. In a graphics rendering pipeline, the output is the colors of the pixels in an image.">pipeline</abbr>.</p>
<p>I will remark that the <abbr title="One of the points that define a geometric primitive, such as the two endpoints of a line segment or the three vertices of a triangle. (The plural is &quot;vertices.&quot;) A vertex can be specified in a coordinate system by giving its x and y coordinates in 2D graphics, or its x, y, and z coordinates in 3D graphics.">vertex</abbr> <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> and the <abbr title="A shader program that will be executed once for each pixel in a primitive. A fragment shader must compute a color for the pixel, or discard it. Fragment shaders are also called pixel shaders.">fragment shader</abbr> for a <abbr title="A sequence of computational stages in a GPU that are applied to incoming data to produce some result. Some of the stages can be programmable shaders, such as vertex shaders, fragment shaders, and compute shaders. In a graphics rendering pipeline, the output is the colors of the pixels in an image.">pipeline</abbr> can be defined in different <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> modules. Also, a <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> module can contain any number of <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> entry points. The entry point functions to be used by a <abbr title="A sequence of computational stages in a GPU that are applied to incoming data to produce some result. Some of the stages can be programmable shaders, such as vertex shaders, fragment shaders, and compute shaders. In a graphics rendering pipeline, the output is the colors of the pixels in an image.">pipeline</abbr> are specified in a <abbr title="A sequence of computational stages in a GPU that are applied to incoming data to produce some result. Some of the stages can be programmable shaders, such as vertex shaders, fragment shaders, and compute shaders. In a graphics rendering pipeline, the output is the colors of the pixels in an image.">pipeline</abbr> descriptor (<a href="../s1/#913-渲染管线">Subsection 9.1.3</a>).</p>
<p>A function is defined using fn followed by the function name, then the formal parameter list, followed optionally by -&gt; and the return type, and finally the function body, which must be enclosed in braces. A user-defined function, other than an entry point function, can be called from anywhere in the same <abbr title="A program to be executed at some stage of the rendering pipeline. OpenGL shaders are written in the GLSL programming languages. For WebGL, only vertex shaders and fragment shaders are supported. WebGPU also has compute shaders, which are used in compute pipelines.">shader</abbr> module.</p>
<p>There are some restrictions on functions. Recursion, direct or indirect, is not allowed. There is no nesting: a function definition cannot be inside another function definition. Array parameters must have a specified size. Pointer types for parameters must be in the function or private namespace. Function names can't be overloaded; that is, you can't have two functions with the same name, even if they have different parameter lists. (But some of the built-in functions are overloaded.) Also, a function cannot have the same name as a global variable.</p>
<p>To finish this section, here are a few user-defined functions:</p>
<div class="highlight"><pre><span></span><code><span class="nx">fn</span><span class="w"> </span><span class="nx">invertedColor</span><span class="p">(</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec4f</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">vec4f</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// return the inverted color</span>
<span class="k">return</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">color</span><span class="p">.</span><span class="nx">rgb</span><span class="p">,</span><span class="w"> </span><span class="nx">color</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">grayify</span><span class="p">(</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">ptr</span><span class="o">&lt;</span><span class="kd">function</span><span class="p">,</span><span class="nx">vec4f</span><span class="o">&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// modify color in place</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="nx">color</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">gray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">r</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">g</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.59</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">b</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.11</span><span class="p">;</span>
<span class="w">    </span><span class="o">*</span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">vec4f</span><span class="p">(</span><span class="w"> </span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">gray</span><span class="p">,</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="p">);</span><span class="w">  </span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">min10</span><span class="p">(</span><span class="w"> </span><span class="nx">A</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">array</span><span class="o">&lt;</span><span class="nx">f32</span><span class="p">,</span><span class="mf">10</span><span class="o">&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">f32</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// parameter is passed by value!</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">A</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">min</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">min</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">A</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">min</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">fn</span><span class="w"> </span><span class="nx">simpleLighting</span><span class="p">(</span><span class="nx">N</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">L</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">V</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">,</span><span class="w"> </span><span class="nx">diffuse</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nx">vec3f</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// N is the unit surface normal vector.</span>
<span class="w">    </span><span class="c1">// L is the unit vector pointing towards the light.</span>
<span class="w">    </span><span class="c1">// V is the unit vector pointing towards viewer</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">dot</span><span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="nx">L</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// wrong side of surface to be illuminated</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span><span class="w">   </span><span class="c1">// return the zero vector (black)</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kd">var</span><span class="w"> </span><span class="nx">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">diffuse</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">dot</span><span class="p">(</span><span class="nx">N</span><span class="p">,</span><span class="nx">L</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">R</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="nx">reflect</span><span class="p">(</span><span class="nx">L</span><span class="p">,</span><span class="nx">N</span><span class="p">);</span><span class="w">  </span><span class="c1">// reflected ray;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nx">dot</span><span class="p">(</span><span class="nx">R</span><span class="p">,</span><span class="nx">V</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// add in specular lighting</span>
<span class="w">        </span><span class="c1">// specular color is gray, specular exponent is 10</span>
<span class="w">    </span><span class="nx">color</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">vec3f</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">pow</span><span class="p">(</span><span class="nx">dot</span><span class="p">(</span><span class="nx">R</span><span class="p">,</span><span class="nx">V</span><span class="p">),</span><span class="w"> </span><span class="mf">10</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">color</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年7月6日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年5月26日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.tabs.link", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "toc.follow", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>