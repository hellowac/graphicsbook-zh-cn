
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="计算机图形学概论(graphicsbook)">
      
      
      
        <link rel="canonical" href="https://hellowac.github.io/graphicsbook-zh-cn/cn/c2/s6/">
      
      
        <link rel="prev" href="../s5/">
      
      
        <link rel="next" href="../s7/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>第6节: HTML Canvas图形 - 计算机图形学概论</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      

  
  
  
  
  <style>:root{--md-annotation-icon:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22 12a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M6 13h8l-3.5 3.5 1.42 1.42L17.84 12l-5.92-5.92L10.5 7.5 14 11H6v2Z"/></svg>');}</style>


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="default" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#第6节-html-canvas图形" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../.." title="计算机图形学概论" class="md-header__button md-logo" aria-label="计算机图形学概论" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            计算机图形学概论
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              第6节: HTML Canvas图形
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/graphicsbook-zh-cn/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/graphicsbook-zh-cn/cn/" hreflang="cn" class="md-select__link">
              中文
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/hellowac/graphicsbook-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graphicsbook
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../" class="md-tabs__link">
        
  
    
  
  首页

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../preface/" class="md-tabs__link">
        
  
    
  
  前言

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c1/" class="md-tabs__link">
          
  
    
  
  1.简介

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  2.二维图形

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c3/" class="md-tabs__link">
          
  
    
  
  3.几何

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c4/" class="md-tabs__link">
          
  
    
  
  4.灯光和材质

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c5/" class="md-tabs__link">
          
  
    
  
  5.three.js

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c6/" class="md-tabs__link">
          
  
    
  
  6.WebGL

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c7/" class="md-tabs__link">
          
  
    
  
  7.WebGL 3D

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c8/" class="md-tabs__link">
          
  
    
  
  8.高阶3D

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../c9/" class="md-tabs__link">
          
  
    
  
  9.WEBGPU

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../a1/" class="md-tabs__link">
          
  
    
  
  附录

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
    
  
  关于

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="计算机图形学概论" class="md-nav__button md-logo" aria-label="计算机图形学概论" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    计算机图形学概论
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/hellowac/graphicsbook-zh-cn" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    graphicsbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    首页
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../preface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    前言
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    1.简介
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            1.简介
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 1 节 绘画与绘图
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 2 节：三维(3D)图形的要素
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c1/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第 3 节：硬件与软件
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    2.二维图形
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            2.二维图形
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第1节: 像素、坐标和颜色
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第2节: 形状
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第3节: 变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第4节: 分层建模
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第5节: Java 绘制2D
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    第6节: HTML Canvas图形
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    第6节: HTML Canvas图形
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#261--2d绘制上下文" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.1  2D绘制上下文
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#262--形状" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.2  形状
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#263--描边和填充" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.3  描边和填充
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#264--变换" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.4  变换
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#265--画布辅助" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.5  画布辅助
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#266--像素操作" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.6  像素操作
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#267--图像" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.7  图像
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    第7节: SVG：一种场景描述语言
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c3/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    3.几何
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            3.几何
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.1 OpenGL 1.1 中的形状和颜色
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.2 3D 坐标和变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.3 投影与观看
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.4 多边形网格和 glDrawArrays
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.5 部分线性代数基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c3/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3.6 使用 GLUT 和 JOGL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c4/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    4.灯光和材质
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            4.灯光和材质
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.1 照明简介
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.2 OpenGL 1.1 中的光和材质
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.3 图像纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c4/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4.4 灯光、相机、动作
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c5/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    5.three.js
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7" id="__nav_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            5.three.js
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.1 Three.js 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.2 构建对象
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c5/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5.3 其他功能
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c6/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    6.WebGL
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_8" id="__nav_8_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            6.WebGL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.1 可编程流水线
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.2 第一个例子
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.3 GLSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.4 图像纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c6/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6.5 实现 2D 变换
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c7/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    7.WebGL 3D
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            7.WebGL 3D
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.1 3D变换
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.2 照明和材质
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.3 纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.4 帧缓冲区
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c7/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7.5 WebGL 扩展
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c8/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    8.高阶3D
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_10" id="__nav_10_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            8.高阶3D
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c8/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.1 光线追踪
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c8/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    8.2 路径追踪
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_11" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../c9/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    9.WEBGPU
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_11" id="__nav_11_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            9.WEBGPU
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.1 WebGPU 基础
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.2 实例和索引
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.3 WGSL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.4 WebGPU 中的 3D 图形
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.5 纹理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s6/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.6 计算着色器
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../c9/s7/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    9.7 细节
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_12" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../a1/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    附录
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_12" id="__nav_12_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            附录
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a2/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blender 3D建模
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../a3/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gimp和Inkscape
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../source/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    示例程序源代码
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    术语表
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    关于
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#261--2d绘制上下文" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.1  2D绘制上下文
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#262--形状" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.2  形状
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#263--描边和填充" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.3  描边和填充
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#264--变换" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.4  变换
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#265--画布辅助" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.5  画布辅助
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#266--像素操作" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.6  像素操作
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#267--图像" class="md-nav__link">
    <span class="md-ellipsis">
      2.6.7  图像
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="第6节-html-canvas图形">第6节: <abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> Canvas图形<a class="headerlink" href="#第6节-html-canvas图形" title="Permanent link">&para;</a></h1>
<p><strong><abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> Canvas Graphics</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">中文</label><label for="__tabbed_1_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>现代大多数网络浏览器都支持一种2D图形API，可以用于在网页上创建图像。该API是使用JavaScript实现的，这是用于网页的客户端编程语言。在本节中，我不会涉及JavaScript语言。要理解此处呈现的材料，您不需要了解太多有关它的知识。即使您对此一无所知，也可以了解其2D图形API，并了解它与<a href="../s5/">上一节</a>中介绍的Java API有何相似之处，以及有何不同之处。 （有关JavaScript的简要介绍，请参阅<a href="../../a1/">附录A</a>中的<a href="../a1/s3.md">第A.3节</a>。）</p>
</div>
<div class="tabbed-block">
<p>Most modern web browsers support a 2D graphics <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> that can be used to create images on a web page. The <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> is implemented using <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, the client-side programming language for the web. I won't cover the <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> language in this section. To understand the <abbr title="The properties of an object that determine how that object interacts with light in the environment. Material properties in OpenGL include, for example, diffuse color, specular color, and shininess.">material</abbr> presented here, you don't need to know much about it. Even if you know nothing about it at all, you can learn something about its 2D graphics <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> and see how it is similar to, and how it differs from, the Java <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> presented in the <a href="../s5/">previous section</a>. (For a short introduction to <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, see <a href="../a1/s3.md">Section A.3</a> in <a href="../../a1/">Appendix A</a>.)</p>
</div>
</div>
</div>
<h2 id="261--2d绘制上下文">2.6.1  2D绘制上下文<a class="headerlink" href="#261--2d绘制上下文" title="Permanent link">&para;</a></h2>
<p><strong>The 2D Graphics Context</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">中文</label><label for="__tabbed_2_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>网页的可见内容由诸如标题和段落之类的“元素”组成。内容是使用HTML语言指定的。一个“画布”是一个HTML元素。它在页面上显示为一个空白的矩形区域，可以通过我所称的“HTML画布”图形API用作绘图表面。在网页的源代码中，可以使用以下形式的代码创建一个画布元素</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;800&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;600&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;theCanvas&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
</code></pre></div>
<p>宽度和<em>高度</em>指定了绘图区域的大小，以像素为单位。<em>id</em>是一个标识符，可以在JavaScript中用来引用画布。</p>
<p>要在画布上绘制，您需要一个图形上下文。图形上下文是一个包含用于绘制形状的函数的对象。它还包含记录当前图形状态的变量，包括当前绘图颜色、变换和字体等内容。在这里，我通常将graphics用作指向图形上下文的变量的名称，但变量名当然由程序员决定。这个图形上下文在canvas API中扮演着与Java中的Graphics2D类型的变量相同的角色。一个典型的起点是</p>
<div class="highlight"><pre><span></span><code><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;theCanvas&quot;</span><span class="p">);</span>
<span class="nx">graphics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
</code></pre></div>
<p>第一行使用其id获取网页上画布元素的引用。第二行为该画布元素创建图形上下文。(这段代码将在不支持canvas的网页浏览器中产生错误，因此您可以添加一些错误检查，例如将这些命令放在try...catch语句中。)</p>
<p>通常，您将把画布图形上下文存储在一个全局变量中，并在整个程序中使用相同的图形上下文。这与Java中的情况不同，在Java中，每次调用paintComponent()方法时，通常会获得一个新的Graphics2D上下文，该新上下文处于其初始状态，具有默认的颜色和笔画属性，并且没有应用的变换。当图形上下文是全局的时候，在一个函数调用中对状态的更改将延续到后续的函数调用，除非您采取措施限制它们的影响。这实际上可能导致一种相当常见的错误类型：例如，如果在一个函数中应用了30度的旋转，那么每次调用该函数时，这些旋转都将累积，除非您在再次调用该函数之前采取措施来撤销之前的旋转。</p>
<p>本节的其余部分主要描述了您可以使用画布图形上下文做什么。但是，这里记录了一个使用画布图形的非常简单的网页的完整源代码：</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Canvas Graphics<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">canvas</span><span class="p">;</span><span class="w">    </span><span class="c1">// DOM object corresponding to the canvas</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">graphics</span><span class="p">;</span><span class="w">  </span><span class="c1">// 2D graphics context for drawing on the canvas</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">draw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// draw on the canvas, using the graphics context</span>
<span class="w">        </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;theCanvas&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">graphics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">draw</span><span class="p">();</span><span class="w">  </span><span class="c1">// draw something on the canvas</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">init</span><span class="p">;</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;theCanvas&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;640&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;480&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>对于一个更完整但仍然很简单的例子，您可以查看示例页面<a href="../../../en/source/canvas2d/GraphicsStarter.html">canvas2d/GraphicsStarter.html</a>。(您应该在浏览器中查看该页面，但您也应该阅读源代码。)该示例展示了如何使用画布图形绘制一些基本形状，您可以将其用作自己实验的基础。还有三个更高级的“入门”示例：<a href="../../../en/source/canvas2d/GraphicsPlusStarter.html">canvas2d/GraphicsPlusStarter.html</a>添加了一些绘制形状和设置坐标系统的实用函数；<a href="../../../en/source/canvas2d/AnimationStarter.html">canvas2d/AnimationStarter.html</a>添加了动画并包括一个简单的层次建模示例；以及<a href="../../../en/source/canvas2d/EventsStarter.html">canvas2d/EventsStarter.html</a>展示了如何响应键盘和鼠标事件。</p>
</div>
<div class="tabbed-block">
<p>The visible content of a web page is made up of "elements" such as headlines and paragraphs. The content is specified using the <abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> language. A "canvas" is an <abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> element. It appears on the page as a blank rectangular area which can be used as a drawing surface by what I am calling the "<abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> canvas" graphics <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>. In the source code of a web page, a canvas element is created with code of the form</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;800&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;600&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;theCanvas&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
</code></pre></div>
<p>The width and <em>height</em> give the size of the drawing area, in <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr>. The <em>id</em> is an identifier that can be used to refer to the canvas in <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>.</p>
<p>To draw on a canvas, you need a graphics context. A graphics context is an object that contains functions for drawing shapes. It also contains variables that record the current graphics state, including things like the current drawing color, transform, and font. Here, I will generally use graphics as the name of the variable that refers to the graphics context, but the variable name is, of course, up to the programmer. This graphics context plays the same role in the canvas <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> that a variable of type Graphics2D plays in Java. A typical starting point is</p>
<div class="highlight"><pre><span></span><code><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;theCanvas&quot;</span><span class="p">);</span>
<span class="nx">graphics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
</code></pre></div>
<p>The first line gets a reference to the canvas element on the web page, using its id. The second line creates the graphics context for that canvas element. (This code will produce an error in a web browser that doesn't support canvas, so you might add some error checking such as putting these commands inside a try..catch statement.)</p>
<p>Typically, you will store the canvas graphics context in a global variable and use the same graphics context throughout your program. This is in contrast to Java, where you typically get a new Graphics2D context each time the paintComponent() method is called, and that new context is in its initial state with default color and stroke properties and with no applied transform. When a graphics context is global, changes made to the state in one function call will carry over to subsequent function calls, unless you do something to limit their effect. This can actually lead to a fairly common type of bug: For example, if you apply a 30-degree <abbr title="A geometric transform that rotates each point by a specified angle about some point (in 2D) or axis (in 3D).">rotation</abbr> in a function, those rotations will accumulate each time the function is called, unless you do something to undo the previous <abbr title="A geometric transform that rotates each point by a specified angle about some point (in 2D) or axis (in 3D).">rotation</abbr> before the function is called again.</p>
<p>The rest of this section will be mostly concerned with describing what you can do with a canvas graphics context. But here, for the record, is the complete source code for a very minimal web page that uses canvas graphics:</p>
<div class="highlight"><pre><span></span><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Canvas Graphics<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">canvas</span><span class="p">;</span><span class="w">    </span><span class="c1">// DOM object corresponding to the canvas</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">graphics</span><span class="p">;</span><span class="w">  </span><span class="c1">// 2D graphics context for drawing on the canvas</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">draw</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// draw on the canvas, using the graphics context</span>
<span class="w">        </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Hello World&quot;</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">,</span><span class="w"> </span><span class="mf">20</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">canvas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;theCanvas&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">graphics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">draw</span><span class="p">();</span><span class="w">  </span><span class="c1">// draw something on the canvas</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">init</span><span class="p">;</span>

<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">canvas</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;theCanvas&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;640&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;480&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">canvas</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</code></pre></div>
<p>For a more complete, though still minimal, example, you can look at the sample page <a href="../../../en/source/canvas2d/GraphicsStarter.html">canvas2d/GraphicsStarter.html</a>. (You should look at the page in a browser, but you should also read the source code.) This example shows how to draw some basic shapes using canvas graphics, and you can use it as a basis for your own experimentation. There are also three more advanced "starter" examples: <a href="../../../en/source/canvas2d/GraphicsPlusStarter.html">canvas2d/GraphicsPlusStarter.html</a> adds some utility functions for drawing shapes and setting up a <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr>; <a href="../../../en/source/canvas2d/AnimationStarter.html">canvas2d/AnimationStarter.html</a> adds <abbr title="A sequence of images that, when displayed quickly one after the other, will produce the impression of continuous motion or change. The term animation also refers to the process of creating such image sequences.">animation</abbr> and includes a simple <abbr title="Creating complex geometric models in a hierarchical fashion, starting with geometric primitives, combining them into components that can then be further combined into more complex components, and so on.">hierarchical modeling</abbr> example; and <a href="../../../en/source/canvas2d/EventsStarter.html">canvas2d/EventsStarter.html</a> shows how to respond to keyboard and mouse events.</p>
</div>
</div>
</div>
<h2 id="262--形状">2.6.2  形状<a class="headerlink" href="#262--形状" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">中文</label><label for="__tabbed_3_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>画布上的默认坐标系统是通常的：单位是一个像素；(0,0)位于左上角；x坐标向右增加；y坐标向下增加。x和y值的范围由<canvas>元素的宽度和高度属性给出。这里对于度量单位的术语“<abbr title="像素: 数字图像由称为像素的小矩形的行和列组成。为了指定数字图像，需要为图像中的每个像素分配一种颜色。">像素</abbr>”并不完全正确。可能我应该说类似“一个名义像素”的东西。在典型的桌面分辨率下没有放大的情况下，度量单位是一个像素。如果您在浏览器窗口中应用放大，度量单位将被拉伸。在高分辨率屏幕上，默认坐标系统中的一个单位可能对应于显示设备上的多个实际像素。</p>
<p>画布API只支持一组非常有限的基本形状。事实上，唯一的基本形状是矩形和文本。其他形状必须创建为路径。形状可以描边和填充。这包括文本：当你描边一个文本字符串时，一个笔沿着字符的轮廓被拖动；当你填充一个字符串时，字符的内部被填充。只有在字符相当大时，描边文本才真正有意义。以下是绘制矩形和文本的函数，其中graphics指代表示图形上下文的对象：</p>
<ul>
<li><code>graphics.fillRect(x,y,w,h)</code> — 绘制以(x,y)为角的填充矩形，宽度为w，高度为h。如果宽度或高度小于或等于零，将不绘制任何内容。</li>
<li><code>graphics.strokeRect(x,y,w,h)</code> — 描边相同矩形的轮廓。</li>
<li><code>graphics.clearRect(x,y,w,h)</code> — 通过填充具有完全透明像素的矩形来清除矩形，允许画布的背景显示出来。背景由画布所在的网页的属性确定。它可能是背景颜色、图像，甚至是另一个画布。</li>
<li><code>graphics.fillText(str,x,y)</code> — 填充字符串str中的字符。字符串基线的左端定位在点(x,y)处。</li>
<li><code>graphics.strokeText(str,x,y)</code> — 描边字符串中字符的轮廓。</li>
</ul>
<p>可以使用图形上下文中的函数创建路径。上下文跟踪一个“当前路径”。在当前版本的API中，路径不是由对象表示的，也没有办法同时处理多个路径或保留路径的副本以供以后重用。路径可以包含线段、贝塞尔曲线和圆弧。以下是处理路径的最常见函数：</p>
<ul>
<li><code>graphics.beginPath()</code> — 开始一个新路径。任何先前的路径都将被丢弃，图形上下文中的当前路径现在为空。请注意，图形上下文还会跟踪当前点，即当前路径中的最后一个点。调用graphics.beginPath()后，当前点未定义。</li>
<li><code>graphics.moveTo(x,y)</code> — 将当前点移动到(x,y)，而不添加任何内容到路径中。这可以用于路径的起点或者开始新的不连续路径段。</li>
<li><code>graphics.lineTo(x,y)</code> — 将从当前点开始并以(x,y)结束的线段添加到路径中，并将当前点移动到(x,y)。</li>
<li><code>graphics.bezierCurveTo(cx1,cy1,c2x,cy2,x,y)</code> — 将立方贝塞尔曲线添加到路径中。曲线从当前点开始，以(x,y)结束。点(cx1,cy1)和(cx2,cy2)是曲线的两个控制点。（贝塞尔曲线及其控制点在2.2.3小节中有讨论。）</li>
<li><code>graphics.quadraticCurveTo(cx,cy,x,y)</code> — 从当前点到(x,y)添加二次贝塞尔曲线，控制点为(cx,cy)。</li>
<li><code>graphics.arc(x,y,r,startAngle,endAngle)</code> — 添加以中心点(x,y)和半径r的圆的弧。接下来的两个参数给出弧的起始和结束角度。它们以弧度表示。弧在正方向上从起始角度延伸到结束角度。（正方向是从正x轴向正y轴的方向旋转；这在默认坐标系统中是顺时针方向。）可以将可选的第五个参数设置为true以获得一个向负方向延伸的弧。绘制弧后，当前点在弧的末端。如果在调用graphics.arc之前有一个当前点，那么在绘制弧之前，会向路径添加一条从当前点到弧的起始点的线段。（回想一下，graphics.beginPath()之后立即没有当前点。）</li>
<li><code>graphics.closePath()</code> — 将从当前点添加到当前曲线段的起始点的线段添加到路径中。（回想一下，每次使用moveTo时，都会开始一个新的曲线段。）</li>
</ul>
<p>使用这些命令创建的曲线不会绘制任何东西。要使图像中出现可见的东西，您必须填充或描边路径。</p>
<p>命令<code>graphics.fill()</code>和<code>graphics.stroke()</code>用于填充和描边当前路径。如果填充一个未闭合的路径，填充算法会像添加了一条最终线段来关闭路径一样。当你描边一个形状时，虚拟笔的中心沿着路径移动。因此，对于高精度的画布绘制，通常使用通过像素中心而不是角落的路径。例如，要绘制一条从坐标为(100,200)的像素延伸到坐标为(300,200)的像素的线，实际上要描边的几何线的端点是(100.5,200.5)和(100.5,300.5)。我们应该看一些例子。绘制一条线需要四个步骤：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span><span class="w">          </span><span class="c1">// 开始一个新路径</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">100.5</span><span class="p">,</span><span class="mf">200.5</span><span class="p">);</span><span class="w">  </span><span class="c1">// 新路径的起始点</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mf">300.5</span><span class="p">,</span><span class="mf">200.5</span><span class="p">);</span><span class="w">  </span><span class="c1">// 添加一条线到点(300.5,200.5)</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span><span class="w">             </span><span class="c1">// 绘制线</span>
</code></pre></div>
<p>记住，直到下一次调用<code>graphics.beginPath()</code>，线都会作为当前路径的一部分保留。以下是如何绘制一个填充的、正八边形，中心位于(200,400)，半径为100的方法：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">300</span><span class="p">,</span><span class="mf">400</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="o">/</span><span class="mf">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">100</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">100</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">    </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</code></pre></div>
<p>函数<code>graphics.arc()</code>可用于绘制圆，起始角度为0，结束角度为2*Math.PI。以下是半径为100、中心位于200,300的填充圆：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</code></pre></div>
<p>要仅绘制圆的轮廓，请将<code>graphics.fill()</code>替换为<code>graphics.stroke()</code>。您可以对同一路径应用这两个操作。如果查看<code>graphics.arc()</code>的详细信息，您可以看到如何绘制圆的扇形：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">);</span><span class="w">   </span><span class="c1">// 将当前点移动到圆的中心。</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">,</span><span class="mf">100</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// 弧，加上从当前点到弧的末端的线。</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">);</span><span class="w">  </span><span class="c1">// 从弧的末端回到圆的中心的线。</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span><span class="w">  </span><span class="c1">// 填充扇形。</span>
</code></pre></div>
<p>没有办法绘制不是圆的椭圆，除非使用变换。我们将在本节后面介绍这一点。但是JavaScript有一个有趣的特性，即可以向现有对象添加新的函数和属性。示例程序<a href="../../../en/source/canvas2d/GraphicsPlusStarter.html">canvas2d/GraphicsPlusStarter.html</a>展示了如何向图形上下文添加函数来绘制线条、椭圆和其他不在API中的形状。</p>
</div>
<div class="tabbed-block">
<p>The default <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr> on a canvas is the usual: The unit of measure is one <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>; (0,0) is at the upper left corner; the x-coordinate increases to the right; and the y-coordinate increases downward. The range of x and y values is given by the width and height properties of the <canvas> element. The term "<abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>" here for the unit of measure is not really correct. Probably, I should say something like "one nominal <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>." The unit of measure is one <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> at typical desktop resolution with no magnification. If you apply a magnification to a browser window, the unit of measure gets stretched. And on a high-resolution screen, one unit in the default <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr> might correspond to several actual <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> on the display device.</p>
<p>The canvas <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr> supports only a very limited set of basic shapes. In fact, the only basic shapes are rectangles and text. Other shapes must be created as paths. Shapes can be stroked and filled. That includes text: When you stroke a string of text, a pen is dragged along the outlines of the characters; when you fill a string, the insides of the characters are filled. It only really makes sense to stroke text when the characters are rather large. Here are the functions for drawing rectangles and text, where graphics refers to the object that represents the graphics context:</p>
<ul>
<li><code>graphics.fillRect(x,y,w,h)</code> — draws a filled rectangle with corner at (x,y), with width w and with height h. If the width or the height is less than or equal to zero, nothing is drawn.</li>
<li><code>graphics.strokeRect(x,y,w,h)</code> — strokes the outline of the same rectangle.</li>
<li><code>graphics.clearRect(x,y,w,h)</code> — clears the rectangle by filling it with fully transparent <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr>, allowing the background of the canvas to show. The background is determined by the properties of the web page on which the canvas appears. It might be a background color, an image, or even another canvas.</li>
<li><code>graphics.fillText(str,x,y)</code> — fills the characters in the string str. The left end of the baseline of the string is positioned at the point (x,y).</li>
<li><code>graphics.strokeText(str,x,y)</code> — strokes the outlines of the characters in the string.</li>
</ul>
<p>A path can be created using functions in the graphics context. The context keeps track of a "current path." In the current version of the <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>, paths are not represented by objects, and there is no way to work with more than one path at a time or to keep a copy of a path for later reuse. Paths can contain lines, Bezier curves, and circular arcs. Here are the most common functions for working with paths:</p>
<ul>
<li><code>graphics.beginPath()</code> — start a new path. Any previous path is discarded, and the current path in the graphics context is now empty. Note that the graphics context also keeps track of the current point, the last point in the current path. After calling graphics.beginPath(), the current point is undefined.</li>
<li><code>graphics.moveTo(x,y)</code> — move the current point to (x,y), without adding anything to the path. This can be used for the starting point of the path or to start a new, disconnected segment of the path.</li>
<li><code>graphics.lineTo(x,y)</code> — add the line segment starting at current point and ending at (x,y) to the path, and move the current point to (x,y).</li>
<li><code>graphics.bezierCurveTo(cx1,cy1,c2x,cy2,x,y)</code> — add a cubic <abbr title="A smooth curve between two points defined by parametric polynomial equations. A cubic Bezier curve segment is defined by its two endpoints P1 and P2 and by two control points C1 and C2. The tangent to the curve (its direction and speed) at P1 is given by the line from P1 to C1. The tangent vector to the curve at P2 is given by the line from C2 to P2. A quadratic Bezier curve is defined by its two endpoints and a single control point C. The tangent at each endpoint is the line between that endpoint and C.">Bezier curve</abbr> to the path. The curve starts at the current point and ends at (x,y). The points (cx1,cy1) and (cx2,cy2) are the two control points for the curve. (Bezier curves and their control points were discussed in Subsection 2.2.3.)</li>
<li><code>graphics.quadraticCurveTo(cx,cy,x,y)</code> — adds a quadratic <abbr title="A smooth curve between two points defined by parametric polynomial equations. A cubic Bezier curve segment is defined by its two endpoints P1 and P2 and by two control points C1 and C2. The tangent to the curve (its direction and speed) at P1 is given by the line from P1 to C1. The tangent vector to the curve at P2 is given by the line from C2 to P2. A quadratic Bezier curve is defined by its two endpoints and a single control point C. The tangent at each endpoint is the line between that endpoint and C.">Bezier curve</abbr> from the current point to (x,y), with <abbr title="A point that does not lie on the curve but that is used to help control the shape of the curve. For example, a control point for a Bezier curve segment is used to specify the tangent vector (direction and speed) of the curve at an endpoint.">control point</abbr> (cx,cy).</li>
<li><code>graphics.arc(x,y,r,startAngle,endAngle)</code> — adds an arc of the circle with center (x,y) and radius r. The next two parameters give the starting and ending angle of the arc. They are measured in radians. The arc extends in the positive direction from the start angle to the end angle. (The positive <abbr title="A geometric transform that rotates each point by a specified angle about some point (in 2D) or axis (in 3D).">rotation</abbr> direction is from the positive x-axis towards the positive y-axis; this is clockwise in the default <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr>.) An optional fifth parameter can be set to true to get an arc that extends in the negative direction. After drawing the arc, the current point is at the end of the arc. If there is a current point before graphics.arc is called, then before the arc is drawn, a line is added to the path that extends from the current point to the starting point of the arc. (Recall that immediately after graphics.beginPath(), there is no current point.)</li>
<li><code>graphics.closePath()</code> — adds to the path a line from the current point back to the starting point of the current segment of the curve. (Recall that you start a new segment of the curve every time you use moveTo.)</li>
</ul>
<p>Creating a curve with these commands does not draw anything. To get something visible to appear in the image, you must fill or stroke the path.</p>
<p>The commands graphics.fill() and graphics.stroke() are used to fill and to stroke the current path. If you fill a path that has not been closed, the fill algorithm acts as though a final line segment had been added to close the path. When you stroke a shape, it's the center of the virtual pen that moves along the path. So, for high-precision canvas drawing, it's common to use paths that pass through the centers of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> rather than through their corners. For example, to draw a line that extends from the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> with coordinates (100,200) to the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> with coordinates (300,200), you would actually stroke the geometric line with endpoints (100.5,200.5) and (100.5,300.5). We should look at some examples. It takes four steps to draw a line:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span><span class="w">          </span><span class="c1">// start a new path</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">100.5</span><span class="p">,</span><span class="mf">200.5</span><span class="p">);</span><span class="w">  </span><span class="c1">// starting point of the new path</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mf">300.5</span><span class="p">,</span><span class="mf">200.5</span><span class="p">);</span><span class="w">  </span><span class="c1">// add a line to the point (300.5,200.5)</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span><span class="w">             </span><span class="c1">// draw the line</span>
</code></pre></div>
<p>Remember that the line remains as part of the current path until the next time you call graphics.beginPath(). Here's how to draw a filled, regular octagon centered at (200,400) and with radius 100:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">300</span><span class="p">,</span><span class="mf">400</span><span class="p">);</span>
<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">8</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">angle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mf">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="p">)</span><span class="o">/</span><span class="mf">8</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">200</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">100</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">400</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">100</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">angle</span><span class="p">);</span>
<span class="w">    </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
<span class="p">}</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">closePath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</code></pre></div>
<p>The function graphics.arc() can be used to draw a circle, with a start angle of 0 and an end angle of 2*Math.PI. Here's a filled circle with radius 100, centered at 200,300:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="w"> </span><span class="mf">200</span><span class="p">,</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="o">*</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</code></pre></div>
<p>To draw just the outline of the circle, use graphics.stroke() in place of graphics.fill(). You can apply both operations to the same path. If you look at the details of graphics.arc(), you can see how to draw a wedge of a circle:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">);</span><span class="w">   </span><span class="c1">// Move current point to center of the circle.</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">,</span><span class="mf">100</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="o">/</span><span class="mf">4</span><span class="p">);</span><span class="w">  </span><span class="c1">// Arc, plus line from current point.</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="mf">200</span><span class="p">,</span><span class="mf">300</span><span class="p">);</span><span class="w">  </span><span class="c1">// Line from end of arc back to center of circle.</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span><span class="w">  </span><span class="c1">// Fill the wedge.</span>
</code></pre></div>
<p>There is no way to draw an oval that is not a circle, except by using transforms. We will cover that later in this section. But <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> has the interesting property that it is possible to add new functions and properties to an existing object. The sample program <a href="../../../en/source/canvas2d/GraphicsPlusStarter.html">canvas2d/GraphicsPlusStarter.html</a> shows how to add functions to a graphics context for drawing lines, ovals, and other shapes that are not built into the <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>.</p>
</div>
</div>
</div>
<h2 id="263--描边和填充">2.6.3  描边和填充<a class="headerlink" href="#263--描边和填充" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">中文</label><label for="__tabbed_4_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
<div class="tabbed-block">
<p>Attributes such as line width that affect the visual appearance of strokes and fills are stored as properties of the graphics context. For example, the value of graphics.lineWidth is a number that represents the width that will be used for strokes. (The width is given in <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> for the default <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr>, but it is subject to transforms.) You can change the line width by assigning a value to this property:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">2.5</span><span class="p">;</span><span class="w">  </span><span class="c1">// Change the current width.</span>
</code></pre></div>
<p>The change affects subsequent strokes. You can also read the current value:</p>
<div class="highlight"><pre><span></span><code><span class="nx">saveWidth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineWidth</span><span class="p">;</span><span class="w">  </span><span class="c1">// Save current width.</span>
</code></pre></div>
<p>The property <em>graphics.lineCap</em> controls the appearance of the endpoints of a stroke. It can be set to "round", "square", or "butt". The quotation marks are part of the value. For example,</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">lineCap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;round&quot;</span><span class="p">;</span>
</code></pre></div>
<p>Similarly, graphics.lineJoin controls the appearance of the point where one segment of a stroke joins another segment; its possible values are "round", "bevel", or "miter". (Line endpoints and joins were discussed in <a href="../s2/#221--基本形状">Subsection 2.2.1</a>.)</p>
<p>Note that the values for <em>graphics.lineCap</em> and <em>graphics.lineJoin</em> are strings. This is a somewhat unusual aspect of the <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>. Several other properties of the graphics context take values that are strings, including the properties that control the colors used for drawing and the font that is used for drawing text.</p>
<p>Color is controlled by the values of the properties <em>graphics.fillStyle</em> and <em>graphics.strokeStyle</em>. The graphics context maintains separate styles for filling and for stroking. A solid color for stroking or filling is specified as a string. Valid color strings are ones that can be used in <abbr title="Cascading Style Sheets. A language that is used for specifying the style, or presentation, of the content of web pages. CSS can control things like colors, backgrounds, fonts, shadows, borders, and the size and position of elements of the page.">CSS</abbr>, the language that is used to specify colors and other style properties of elements on web pages. Many solid colors can be specified by their names, such as "red", "black", and "beige". An <abbr title="A color specified by three numbers giving the amount of red, green, and blue in the color.">RGB color</abbr> can be specified as a string of the form "rgb(r,g,b)", where the parentheses contain three numbers in the range 0 to 255 giving the red, green, and blue components of the color. Hexadecimal color codes are also supported, in the form "#XXYYZZ" where XX, YY, and ZZ are two-digit hexadecimal numbers giving the <abbr title="A color specified by three numbers giving the amount of red, green, and blue in the color.">RGB color</abbr> components. For example,</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;rgb(200,200,255)&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// light blue</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">strokeStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;#0070A0&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// a darker, greenish blue</span>
</code></pre></div>
<p>The style can actually be more complicated than a simple solid color: Gradients and patterns are also supported. As an example, a <abbr title="A pattern of color produced by assigning colors to certain reference points and computing color for other points by interpolating or extrapolating colors from the reference points. The effect is a color progression along line segments between reference points. Different rules for extending the colors beyond those lines produce different types of gradient, such as linear gradients and radial gradients.">gradient</abbr> can be created with a series of steps such as</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="nx">lineargradient</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">createLinearGradient</span><span class="p">(</span><span class="mf">420</span><span class="p">,</span><span class="mf">420</span><span class="p">,</span><span class="mf">550</span><span class="p">,</span><span class="mf">200</span><span class="p">);</span>
<span class="nx">lineargradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">);</span>
<span class="nx">lineargradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="s2">&quot;yellow&quot;</span><span class="p">);</span>
<span class="nx">lineargradient</span><span class="p">.</span><span class="nx">addColorStop</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">lineargradient</span><span class="p">;</span><span class="w">  </span><span class="c1">// Use a gradient fill!</span>
</code></pre></div>
<p>The first line creates a linear <abbr title="A pattern of color produced by assigning colors to certain reference points and computing color for other points by interpolating or extrapolating colors from the reference points. The effect is a color progression along line segments between reference points. Different rules for extending the colors beyond those lines produce different types of gradient, such as linear gradients and radial gradients.">gradient</abbr> that will vary in color along the line segment from the point (420,420) to the point (550,200). Colors for the <abbr title="A pattern of color produced by assigning colors to certain reference points and computing color for other points by interpolating or extrapolating colors from the reference points. The effect is a color progression along line segments between reference points. Different rules for extending the colors beyond those lines produce different types of gradient, such as linear gradients and radial gradients.">gradient</abbr> are specified by the addColorStop function: the first parameter gives the fraction of the distance from the initial point to the final point where that color is applied, and the second is a string that specifies the color itself. A color stop at 0 specifies the color at the initial point; a color stop at 1 specifies the color at the final point. Once a <abbr title="A pattern of color produced by assigning colors to certain reference points and computing color for other points by interpolating or extrapolating colors from the reference points. The effect is a color progression along line segments between reference points. Different rules for extending the colors beyond those lines produce different types of gradient, such as linear gradients and radial gradients.">gradient</abbr> has been created, it can be used both as a fill style and as a stroke style in the graphics context.</p>
<p>Finally, I note that the font that is used for drawing text is the value of the property graphics.font. The value is a string that could be used to specify a font in <abbr title="Cascading Style Sheets. A language that is used for specifying the style, or presentation, of the content of web pages. CSS can control things like colors, backgrounds, fonts, shadows, borders, and the size and position of elements of the page.">CSS</abbr>. As such, it can be fairly complicated, but the simplest versions include a font-size (such as 20px or 150%) and a font-family (such as serif, sans-serif, monospace, or the name of any font that is accessible to the web page). You can add italic or bold or both to the front of the string. Some examples:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;2cm monospace&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// the size is in centimeters</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;bold 18px sans-serif&quot;</span><span class="p">;</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">font</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;italic 150% serif&quot;</span><span class="p">;</span><span class="w">   </span><span class="c1">// size is 150% of the usual size</span>
</code></pre></div>
<p>The default is "10px sans-serif," which is usually too small. Note that text, like all drawing, is subject to coordinate transforms. Applying a <abbr title="A geometric transform that multiplies each coordinate of a point by a number called the scaling factor. Scaling increases or decreases the size of an object, but also moves its points closer to or farther from the origin. Scaling can be uniform—the same in every direction—or non-uniform—with a different scaling factor in each coordinate direction. A negative scaling factor can be used to apply a reflection.">scaling</abbr> operation changes the size of the text, and a negative <abbr title="A geometric transform that multiplies each coordinate of a point by a number called the scaling factor. Scaling increases or decreases the size of an object, but also moves its points closer to or farther from the origin. Scaling can be uniform—the same in every direction—or non-uniform—with a different scaling factor in each coordinate direction. A negative scaling factor can be used to apply a reflection.">scaling</abbr> factor can produce mirror-image text.</p>
</div>
</div>
</div>
<h2 id="264--变换">2.6.4  变换<a class="headerlink" href="#264--变换" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">中文</label><label for="__tabbed_5_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>图形上下文具有三个基本函数，用于通过缩放、旋转和平移修改当前变换。还有一些函数将当前变换与任意变换组合，并完全替换当前变换：</p>
<ul>
<li><code>graphics.scale(sx,sy)</code> — 在x方向缩放sx，y方向缩放sy。</li>
<li><code>graphics.rotate(angle)</code> — 围绕原点以angle弧度旋转。在默认坐标系统中，正旋转是顺时针的。</li>
<li><code>graphics.translate(tx,ty)</code> — 在x方向平移tx，在y方向平移ty。</li>
<li><code>graphics.transform(a,b,c,d,e,f)</code> — 应用仿射变换x1 = a<em>x + c</em>y + e，y1 = b<em>x + d</em>y + f。</li>
<li><code>graphics.setTransform(a,b,c,d,e,f)</code> — 丢弃当前变换，并将当前变换设置为x1 = a<em>x + c</em>y + e，y1 = b<em>x + d</em>y + f。</li>
</ul>
<p>请注意，没有剪切变换，但可以将剪切作为一般变换应用。例如，对于剪切因子为0.5的水平剪切，使用：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</code></pre></div>
<p>要实现分层建模，如<a href="../s4/">第2.4节</a>中讨论的，您需要能够保存当前变换，以便稍后可以恢复它。不幸的是，并没有提供一种方法来从画布图形上下文中读取当前变换。但是，图形上下文本身保留了一堆变换，并提供了推送和弹出当前变换的方法。实际上，这些方法不仅保存和恢复当前变换，它们实际上保存和恢复了几乎整个图形上下文的状态，包括当前颜色、线宽和字体等属性（但不包括当前路径）：</p>
<ul>
<li><code>graphics.save()</code> — 将图形上下文的当前状态的副本（包括当前变换）推送到堆栈上。</li>
<li><code>graphics.restore()</code> — 从堆栈中移除顶部项目，其中包含图形上下文的已保存状态，并将图形上下文恢复为该状态。</li>
</ul>
<p>使用这些方法，使用建模变换绘制对象的基本设置变得如下：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span><span class="w">          </span><span class="c1">// 保存当前状态的副本</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">);</span><span class="w">  </span><span class="c1">// 应用建模变换</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span><span class="w">     </span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span><span class="nx">sy</span><span class="p">);</span>
<span class="p">.</span>
<span class="p">.</span><span class="w">  </span><span class="c1">// 绘制对象！</span>
<span class="p">.</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span><span class="w">       </span><span class="c1">// 恢复保存的状态</span>
</code></pre></div>
<p>请注意，如果绘制对象包括对绘制颜色等属性的任何更改，这些更改也将被<code>graphics.restore()</code>调用撤消。在分层图形中，这通常是您想要的，这消除了保存和恢复颜色等属性的额外语句的需要。</p>
<p>要绘制一个分层模型，您需要遍历一个场景图，可以是过程化的，也可以是作为数据结构的。这与Java几乎相同。实际上，您应该看到您学习的有关变换和建模的基本概念如何适用于画布图形API。这些概念非常普遍，并且甚至适用于3D图形API，只是稍微增加了一些复杂性。示例网页<a href="../../../en/source/canvas2d/HierarchicalModel2D.html">canvas2d/HierarchicalModel2D.html</a>使用2D画布API实现了分层建模。</p>
<hr />
<p>现在我们知道如何进行变换，我们可以看看如何使用画布API绘制一个椭圆。假设我们想要一个中心位于(x,y)，水平半径为r1，垂直半径为r2的椭圆。想法是绘制一个半径为1的圆，中心位于(0,0)，然后对其进行变换。圆需要在水平方向按比例r1缩放，在垂直方向按比例r2缩放。然后，它应该被平移以将其中心从(0,0)移动到(x,y)。我们可以使用<code>graphics.save()</code>和<code>graphics.restore()</code>确保变换仅影响圆。回想一下，代码中的变换顺序与应用于对象的顺序相反，代码如下：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="w"> </span><span class="nx">r1</span><span class="p">,</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// 半径为1的圆</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</code></pre></div>
<p>请注意，当前路径不受<code>graphics.save()</code>和<code>graphics.restore()</code>的影响。因此，在这个例子中，当调用<code>graphics.restore()</code>时，椭圆形状的路径不会被丢弃。当在最后调用<code>graphics.stroke()</code>时，描边的是椭圆形状的路径。另一方面，用于描边的线宽并不受应用于椭圆的缩放变换的影响。请注意，如果最后两个命令的顺序颠倒了，那么线宽将受到缩放的影响。</p>
<p>这里关于变换和路径有一个有趣的观点。在HTML画布API中，用于创建路径的点在保存之前会受到当前变换的影响。也就是说，它们以像素坐标保存。稍后，当路径被描边或填充时，当前变换不会影响路径（尽管它可以影响例如描边时的线宽）。特别地，你不能创建一个路径然后应用不同的变换。例如，你不能创建一个椭圆形状的路径，然后用它来绘制不同位置的多个椭圆。每次绘制椭圆时，它都会在同一个位置，即使对图形上下文应用了不同的平移变换。</p>
<p>在Java中情况不同，在路径中存储的坐标是指定路径的实际数字，即对象坐标。当路径被描边或填充时，会应用当前有效的变换到路径上。路径可以多次重用，以用不同的变换绘制副本。这个评论提供了一个示例，说明看起来非常相似的API可能存在微妙的差异。</p>
</div>
<div class="tabbed-block">
<p>A graphics context has three basic functions for modifying the current transform by <abbr title="A geometric transform that multiplies each coordinate of a point by a number called the scaling factor. Scaling increases or decreases the size of an object, but also moves its points closer to or farther from the origin. Scaling can be uniform—the same in every direction—or non-uniform—with a different scaling factor in each coordinate direction. A negative scaling factor can be used to apply a reflection.">scaling</abbr>, <abbr title="A geometric transform that rotates each point by a specified angle about some point (in 2D) or axis (in 3D).">rotation</abbr>, and <abbr title="A geometric transform that adds a given translation amount to each coordinate of a point. Translation is used to move objects without changing their size or orientation.">translation</abbr>. There are also functions that will compose the current transform with an arbitrary transform and for completely replacing the current transform:</p>
<ul>
<li><code>graphics.scale(sx,sy)</code> — scale by sx in the x-direction and sy in the y-direction.</li>
<li><code>graphics.rotate(angle)</code> — rotate by angle radians about the origin. A positive <abbr title="A geometric transform that rotates each point by a specified angle about some point (in 2D) or axis (in 3D).">rotation</abbr> is clockwise in the default <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr>.</li>
<li><code>graphics.translate(tx,ty)</code> — translate by tx in the x-direction and ty in the y-direction.</li>
<li><code>graphics.transform(a,b,c,d,e,f)</code> — apply the <abbr title="A transform that preserves parallel lines. That is, when the transform is applied to a pair of lines that are parallel, then the resulting transformed lines are also parallel. An affine transform, T, has the property that the transform of the line segment between a point (x1,y1) and a point (x2,y2) is the line between the points T(x1,y1) and T(x2,y2). Effectively, the transform of a line segment can be computed just by transforming its two endpoints. This makes affine transforms very efficient for computer graphics. Any affine transform can be represented as a composition of rotations, translations, and scalings.">affine transform</abbr> x1 = a<em>x + c</em>y + e, and y1 = b<em>x + d</em>y + f.</li>
<li><code>graphics.setTransform(a,b,c,d,e,f)</code> — discard the current transformation, and set the current transformation to be x1 = a<em>x + c</em>y + e, and y1 = b<em>x + d</em>y + f.</li>
</ul>
<p>Note that there is no <abbr title="A shear transformation in 2D leaves some line, L, fixed, and lines perpendicular to L are &quot;tilted&quot; relative to L by the same angle. Another description is that a line parallel to L is mapped to itself, but is moved by an amount proportional to its distance from L. In 3D, a shear transformation leaves some plane, P, fixed, and it maps a plane parallel to P to itself, but moved by an amount proportional to its distance from P.">shear transform</abbr>, but you can apply a shear as a general transform. For example, for a horizontal shear with shear factor 0.5, use</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</code></pre></div>
<p>To implement <abbr title="Creating complex geometric models in a hierarchical fashion, starting with geometric primitives, combining them into components that can then be further combined into more complex components, and so on.">hierarchical modeling</abbr>, as discussed in <a href="../s4/">Section 2.4</a>, you need to be able to save the current transformation so that you can restore it later. Unfortunately, no way is provided to read the current transformation from a canvas graphics context. However, the graphics context itself keeps a <abbr title="A data structure with the operations push() and pop(). Pushing an item onto a stack just adds that item to the stack. Popping from the stack will remove and return the item that was most recently pushed onto the stack.">stack</abbr> of transformations and provides methods for pushing and popping the current transformation. In fact, these methods do more than save and restore the current transformation. They actually save and restore almost the entire state of the graphics context, including properties such as current colors, line width, and font (but not the current path):</p>
<ul>
<li><code>graphics.save()</code> — push a copy of the current state of the graphics context, including the current transformation, onto the <abbr title="A data structure with the operations push() and pop(). Pushing an item onto a stack just adds that item to the stack. Popping from the stack will remove and return the item that was most recently pushed onto the stack.">stack</abbr>.</li>
<li><code>graphics.restore()</code> — remove the top item from the <abbr title="A data structure with the operations push() and pop(). Pushing an item onto a stack just adds that item to the stack. Popping from the stack will remove and return the item that was most recently pushed onto the stack.">stack</abbr>, containing a saved state of the graphics context, and restore the graphics context to that state.</li>
</ul>
<p>Using these methods, the basic setup for drawing an object with a modeling transform becomes:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span><span class="w">          </span><span class="c1">// save a copy of the current state</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">);</span><span class="w">  </span><span class="c1">// apply modeling transformations</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">rotate</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span><span class="w">     </span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="nx">sx</span><span class="p">,</span><span class="nx">sy</span><span class="p">);</span>
<span class="p">.</span>
<span class="p">.</span><span class="w">  </span><span class="c1">// Draw the object!</span>
<span class="p">.</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span><span class="w">       </span><span class="c1">// restore the saved state</span>
</code></pre></div>
<p>Note that if drawing the object includes any changes to <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attributes</abbr> such as drawing color, those changes will be also undone by the call to graphics.restore(). In hierarchical graphics, this is usually what you want, and it eliminates the need to have extra statements for saving and restoring things like color.</p>
<p>To draw a hierarchical model, you need to traverse a <abbr title="A data structure that represents the objects in a scene, together with attributes of the objects and the modeling transformations that are applied to the objects. An image of the scene is created by traversing the scene graph data structure. A scene graph might exist only conceptually, or it might be an actual data structure in a program.">scene graph</abbr>, either procedurally or as a data structure. It's pretty much the same as in Java. In fact, you should see that the basic concepts that you learned about transformations and modeling carry over to the canvas graphics <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>. Those concepts apply very widely and even carry over to 3D graphics APIs, with just a little added complexity. The sample web page <a href="../../../en/source/canvas2d/HierarchicalModel2D.html">canvas2d/HierarchicalModel2D.html</a> implements <abbr title="Creating complex geometric models in a hierarchical fashion, starting with geometric primitives, combining them into components that can then be further combined into more complex components, and so on.">hierarchical modeling</abbr> using the 2D canvas <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>.</p>
<hr />
<p>Now that we know how to do transformations, we can see how to draw an oval using the canvas <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>. Suppose that we want an oval with center at (x,y), with horizontal radius r1 and with vertical radius r2. The idea is to draw a circle of radius 1 with center at (0,0), then transform it. The circle needs to be scaled by a factor of r1 horizontally and r2 vertically. It should then be translated to move its center from (0,0) to (x,y). We can use graphics.save() and graphics.restore() to make sure that the transformations only affect the circle. Recalling that the order of transforms in the code is the opposite of the order in which they are applied to objects, this becomes:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">save</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">translate</span><span class="p">(</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">scale</span><span class="p">(</span><span class="w"> </span><span class="nx">r1</span><span class="p">,</span><span class="w"> </span><span class="nx">r2</span><span class="w"> </span><span class="p">);</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">arc</span><span class="p">(</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">1</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span><span class="w"> </span><span class="p">);</span><span class="w">  </span><span class="c1">// a circle of radius 1</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">restore</span><span class="p">();</span>
<span class="nx">graphics</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</code></pre></div>
<p>Note that the current path is not affected by the calls to graphics.save() and graphics.restore(). So, in the example, the oval-shaped path is not discarded when graphics.restore() is called. When graphics.stroke() is called at the end, it is the oval-shaped path that is stroked. On the other hand, the line width that is used for the stroke is not affected by the scale transform that was applied to the oval. Note that if the order of the last two commands were reversed, then the line width would be subject to the <abbr title="A geometric transform that multiplies each coordinate of a point by a number called the scaling factor. Scaling increases or decreases the size of an object, but also moves its points closer to or farther from the origin. Scaling can be uniform—the same in every direction—or non-uniform—with a different scaling factor in each coordinate direction. A negative scaling factor can be used to apply a reflection.">scaling</abbr>.</p>
<p>There is an interesting point here about transforms and paths. In the <abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> canvas <abbr title="Application Programming Interface. A collection of related classes, functions, constants, etc., for performing some task. An API is an &quot;interface&quot; in the sense that it can be used without understanding how its functionality is actually implemented.">API</abbr>, the points that are used to create a path are transformed by the current transformation before they are saved. That is, they are saved in <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> coordinates. Later, when the path is stroked or filled, the current transform has no effect on the path (although it can affect, for example, the line width when the path is stroked). In particular, you can't make a path and then apply different transformations. For example, you can't make an oval-shaped path, and then use it to draw several ovals in different positions. Every time you draw the oval, it will be in the same place, even if different <abbr title="A geometric transform that adds a given translation amount to each coordinate of a point. Translation is used to move objects without changing their size or orientation.">translation</abbr> transforms are applied to the graphics context.</p>
<p>The situation is different in Java, where the coordinates that are stored in the path are the actual numbers that are used to specify the path, that is, the <abbr title="The coordinate system in which the coordinates for points in an object are originally specified, before they are transformed by any modeling or other transform that will be applied to the object.">object coordinates</abbr>. When the path is stroked or filled, the transformation that is in effect at that time is applied to the path. The path can be reused many times to draw copies with different transformations. This comment is offered as an example of how APIs that look very similar can have subtle differences.</p>
</div>
</div>
</div>
<h2 id="265--画布辅助">2.6.5  画布辅助<a class="headerlink" href="#265--画布辅助" title="Permanent link">&para;</a></h2>
<p><strong>Auxiliary Canvases</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">中文</label><label for="__tabbed_6_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>在<a href="../s5/#255--bufferedimage-and-pixels">第2.5.5小节</a>中，我们看了一下示例程序<a href="../../../en/source/java2d/JavaPixelManipulation.java">java2d/JavaPixelManipulation.java</a>，它使用了<ins class="critic">BufferedImage</ins>来实现离屏画布并允许直接操作单个像素的颜色。相同的思想可以应用在HTML画布图形中，尽管实现方式有些不同。示例网页应用程序<a href="../../../en/source/canvas2d/SimplePaintProgram.html">canvas2d/SimplePaintProgram.html</a>基本上和Java程序做了相同的事情（除了图像滤镜）。</p>
<p>下面是具有相同功能的程序的实时演示版本。你可以尝试它来看看各种绘图工具是如何工作的。别忘了试试“Smudge”工具！（它必须应用到你已经绘制的形状上。）</p>
<p><iframe src="../../../en/demos/c2/SimplePaintDemo.html" width="600" height="425"></iframe></p>
<p>对于JavaScript，网页被表示为一个数据结构，由一个称为DOM（Document Object Model）的标准定义。对于离屏画布，我们可以使用一个不属于该数据结构的<canvas>，因此不是页面的一部分。在JavaScript中，<canvas>可以通过函数调用document.createElement("canvas")来创建。有一种方法可以将这种动态创建的画布添加到DOM中的网页，但是即使不这样做，它也可以作为离屏画布使用。要使用它，您必须设置它的width和height属性，并且需要一个用于绘制的图形上下文。下面是一个创建640x480画布，获取画布的图形上下文，并用白色填充整个画布的示例代码：</p>
<div class="highlight"><pre><span></span><code><span class="nx">OSC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 离屏画布</span>

<span class="nx">OSC</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">640</span><span class="p">;</span><span class="w">    </span><span class="c1">// 必须明确设置OSC的大小。</span>
<span class="nx">OSC</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">480</span><span class="p">;</span>

<span class="nx">OSG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSC</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// 用于在OSC上绘制的图形上下文。</span>

<span class="nx">OSG</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;white&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// 使用上下文将OSC填充为白色。</span>
<span class="nx">OSG</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="nx">OSC</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">OSC</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</code></pre></div>
<p>示例程序允许用户在画布上拖动鼠标来绘制一些形状。离屏画布保存了图片的官方副本，但用户看不到它。还有一个用户可以看到的屏幕画布。每当图片被修改时，离屏画布被复制到屏幕画布上。当用户拖动鼠标来绘制线条、椭圆或矩形时，新形状实际上是在屏幕上绘制的，覆盖在离屏画布的内容上。只有当用户完成拖动操作时，才会将新形状添加到离屏画布上。对于其他工具，更改直接应用于离屏画布，然后将结果复制到屏幕上。这是对Java程序的精确模仿。</p>
<p>（上面显示的演示版本实际上使用了一种略有不同的技术来实现相同的效果。它使用了两个屏幕画布，一个完全位于另一个之上。较低的画布保存了实际图像。上部的画布完全透明，除非用户正在绘制线条、椭圆或矩形。当用户拖动鼠标绘制这样的形状时，新形状是在上部画布上绘制的，它隐藏了位于形状下方的下部画布的部分。当用户释放鼠标时，形状被添加到下部画布上，上部画布被清除以再次完全透明。同样，其他工具直接操作下部画布。）</p>
</div>
<div class="tabbed-block">
<p>In <a href="../s5/#255--bufferedimage-and-pixels">Subsection 2.5.5</a>, we looked at the sample program <a href="../../../en/source/java2d/JavaPixelManipulation.java">java2d/JavaPixelManipulation.java</a>, which uses a <ins class="critic">BufferedImage</ins> both to implement an <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> and to allow direct manipulation of the colors of individual <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr>. The same ideas can be applied in <abbr title="HyperText Markup Language. A language that is used for specifying the content of web pages. An HTML document is made up of text, along with &quot;elements&quot; for adding other content, such as images, and for defining the structure of the document. Because of nesting of elements, the document can be represented by a tree-like data structure.">HTML</abbr> canvas graphics, although the way it's done is a little different. The sample web application <a href="../../../en/source/canvas2d/SimplePaintProgram.html">canvas2d/SimplePaintProgram.html</a> does pretty much the same thing as the Java program (except for the image filters).</p>
<p>Here is a live demo version of the program that has the same functionality. You can try it out to see how the various drawing tools work. Don't forget to try the "Smudge" tool! (It has to be applied to shapes that you have already drawn.)</p>
<p><iframe src="../../../en/demos/c2/SimplePaintDemo.html" width="600" height="425"></iframe></p>
<p>For <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, a web page is represented as a data structure, defined by a standard called the <abbr title="Document Object Model. A specification for representing a web page (and other kinds of structured document) as a tree-like data structure. Can also refer to the data structure itself, as in &quot;the DOM for this web page.&quot; A web page can be modified dynamically by manipulating its DOM, using the JavaScript programming language.">DOM</abbr>, or Document Object model. For an <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr>, we can use a <canvas> that is not part of that data structure and therefore is not part of the page. In <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>, a <canvas> can be created with the function call document.createElement("canvas"). There is a way to add this kind of dynamically created canvas to the <abbr title="Document Object Model. A specification for representing a web page (and other kinds of structured document) as a tree-like data structure. Can also refer to the data structure itself, as in &quot;the DOM for this web page.&quot; A web page can be modified dynamically by manipulating its DOM, using the JavaScript programming language.">DOM</abbr> for the web page, but it can be used as an <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> without doing so. To use it, you have to set its width and height properties, and you need a graphics context for drawing on it. Here, for example, is some code that creates a 640-by-480 canvas, gets a graphics context for the canvas, and fills the whole canvas with white:</p>
<div class="highlight"><pre><span></span><code><span class="nx">OSC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;canvas&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// off-screen canvas</span>

<span class="nx">OSC</span><span class="p">.</span><span class="nx">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">640</span><span class="p">;</span><span class="w">    </span><span class="c1">// Size of OSC must be set explicitly.</span>
<span class="nx">OSC</span><span class="p">.</span><span class="nx">height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">480</span><span class="p">;</span>

<span class="nx">OSG</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSC</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s2">&quot;2d&quot;</span><span class="p">);</span><span class="w">  </span><span class="c1">// Graphics context for drawing on OSC.</span>

<span class="nx">OSG</span><span class="p">.</span><span class="nx">fillStyle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;white&quot;</span><span class="p">;</span><span class="w">  </span><span class="c1">// Use the context to fill OSC with white.</span>
<span class="nx">OSG</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="nx">OSC</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span><span class="nx">OSC</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</code></pre></div>
<p>The sample program lets the user drag the mouse on the canvas to draw some shapes. The <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> holds the official copy of the picture, but it is not seen by the user. There is also an on-screen canvas that the user sees. The <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> is copied to the on-screen canvas whenever the picture is modified. While the user is dragging the mouse to draw a line, oval, or rectangle, the new shape is actually drawn on-screen, over the contents of the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr>. It is only added to the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> when the user finishes the drag operation. For the other tools, changes are made directly to the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr>, and the result is then copied to the screen. This is an exact imitation of the Java program.</p>
<p>(The demo version shown above actually uses a somewhat different technique to accomplish the same thing. It uses two on-screen canvases, one located exactly on top of the other. The lower canvas holds the actual image. The upper canvas is completely transparent, except when the user is drawing a line, oval, or rectangle. While the user is dragging the mouse to draw such a shape, the new shape is drawn on the upper canvas, where it hides the part of the lower canvas that is beneath the shape. When the user releases the mouse, the shape is added to the lower canvas and the upper canvas is cleared to make it completely transparent again. Again, the other tools operate directly on the lower canvas.)</p>
</div>
</div>
</div>
<h2 id="266--像素操作">2.6.6  像素操作<a class="headerlink" href="#266--像素操作" title="Permanent link">&para;</a></h2>
<p><strong>Pixel Manipulation</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">中文</label><label for="__tabbed_7_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><a href="../../../en/source/canvas2d/SimplePaintProgram.html"><em>示例程序</em></a>中的“Smudge”工具是通过对图像中的像素颜色分量值进行计算来实现的。该实现需要一种方法来读取画布中像素的颜色。可以使用函数 <em>graphics.getPixelData(x,y,w,h)</em> 来完成，其中 graphics 是画布的 2D 图形上下文。该函数读取一个像素矩形的颜色，其中 (x,y) 是矩形的左上角，w 是宽度，h 是高度。这些参数始终以像素坐标表示。例如：</p>
<div class="highlight"><pre><span></span><code><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">20</span><span class="p">,</span><span class="mf">10</span><span class="p">)</span>
</code></pre></div>
<p>这返回了画布左上角的一个 20x10 矩形的颜色数据。返回值 colors 是一个对象，具有属性 <em>colors.width</em>、<em>colors.height</em> 和 <em>colors.data</em>。宽度和高度给出了返回数据中像素的行数和列数（根据文档，在高分辨率屏幕上，它们可能与函数调用中的宽度和高度不同。数据可以是显示设备上的真实物理像素，而不是画布上像素坐标系中使用的“名义”<abbr title="像素: 数字图像由称为像素的小矩形的行和列组成。为了指定数字图像，需要为图像中的每个像素分配一种颜色。">像素</abbr>。每个名义像素可能对应多个设备像素。我不确定这在实践中是否会真正发生）。</p>
<p>colors.data 的值是一个数组，对于每个像素有四个数组元素。这四个元素包含了像素的红色、绿色、蓝色和 <abbr title="An extra component (that is, one of the numbers that are used to specify a color) in a color model that is not part of the actual color specification. The alpha component is extra information. It is most often used to specify the degree of transparency of a color.">alpha</abbr> <abbr title="颜色模型中用于指定颜色的数字之一。例如，在 RGB 颜色模型中，一个颜色由三个颜色分量表示，分别代表颜色中红色、绿色和蓝色的量。">颜色分量</abbr>，以整数形式给出，范围从 0 到 255。对于位于画布外的像素，四个组件值都将为零。该数组是 Uint8ClampedArray 类型的值，其元素是限制在 0 到 255 范围内的 8 位无符号整数。这是 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 的一种<strong>类型化数组</strong>数据类型，只能保存特定数值类型的值。例如，假设你只想读取坐标为 (x,y) 处的一个像素的 RGB 颜色。你可以设置</p>
<div class="highlight"><pre><span></span><code><span class="nx">pixel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
</code></pre></div>
<p>然后像素的 RGB 颜色分量为 <code>R = pixel.data[0]</code>、<code>G = pixel.data[1]</code> 和 <code>B = pixel.data[2]</code>。</p>
<p>函数 <em>graphics.putImageData(imageData,x,y)</em> 用于将图像数据对象中的颜色复制到画布中，将其放置到画布中的矩形中，其左上角位于 (x,y)。imageData 对象可以是通过调用 <em>graphics.getImageData</em> 返回的对象，可能已经修改了其颜色数据。或者你可以通过调用 <em>graphics.createImageData(w,h)</em> 创建一个空的图像数据对象，并填充数据。</p>
<p>让我们考虑示例程序中的“Smudge”工具。当用户使用此工具点击鼠标时，我使用 <em>OSG.getImageData</em> 来获取围绕鼠标位置的 9x9 像素正方形的颜色数据。OSG 是包含图像的画布的图形上下文。由于我希望对颜色值进行实数运算，所以将颜色分量复制到另一个类型化数组中，即类型为 <ins class="critic">Float32Array</ins> 的数组，它可以保存 32 位浮点数。以下是我调用的函数：</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">grabSmudgeData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (x,y) 表示鼠标位置</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">smudgeColorArray</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 第一次调用此函数时创建图像数据和数组。</span>
<span class="w">        </span><span class="nx">smudgeImageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">createImageData</span><span class="p">(</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span>
<span class="w">        </span><span class="nx">smudgeColorArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 将颜色分量数据复制到 Float32Array 中。</span>
<span class="w">        </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>浮点数数组 <em>smudgeColorArray</em> 将用于计算鼠标移动时图像的新颜色值。来自该数组的颜色值将被复制到图像数据对象 <em>smudgeImageData</em> 中，然后将用于将颜色值放入图像中。这是另一个函数中完成的，该函数在用户将“Smudge”工具拖动到画布上的每个点时调用：</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">swapSmudgeData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (x,y) 是新的鼠标位置</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span><span class="w">  </span><span class="c1">// 获取图像中的颜色数据</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 一个像素的颜色数据在下面四个数组位置中。</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// alpha 分量不为零；两个像素都在画布中；</span>
<span class="w">            </span><span class="c1">// （getImageData() 在实际不属于画布的像素坐标处获取 alpha 值为 0）。</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// 计算新的 RGB 值</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">newSmudge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="p">;</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">newImage</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="p">;</span>
<span class="w">                </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImage</span><span class="p">;</span>
<span class="w">                </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newSmudge</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">255</span><span class="p">;</span><span class="w">  </span><span class="c1">// alpha 分量</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// 其中一个 alpha 分量为零；将输出颜色设置为全零，即“透明黑色”，这不会影响画布中像素的颜色。</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">smudgeImageData</span><span class="p">,</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// 将新颜色复制到画布中</span>
<span class="p">}</span>
</code></pre></div>
<p>在此函数中，对鼠标位置周围的一个 9x9 像素正方形中的每个像素计算了一个新的颜色。颜色被当前像素的颜色和<em>smudgeColorArray</em>中对应像素的颜色的加权平均值所替代。同时，<em>smudgeColorArray</em> 中的颜色也被类似的加权平均值替代。</p>
<p>值得尝试理解此示例，以了解如何进行颜色数据的逐像素处理。有关更多细节，请查看示例的<a href="../../../en/source/canvas2d/SimplePaintProgram.html">源代码</a>。</p>
</div>
<div class="tabbed-block">
<p>The "Smudge" tool in the <a href="../../../en/source/canvas2d/SimplePaintProgram.html"><em>sample program</em></a> and demo is implemented by computing with the <abbr title="One of the numbers used in a color model to specify a color. For example, in the RGB color model, a color is specified by three color components representing the amounts of red, green, and blue in the color.">color component</abbr> values of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> in the image. The implementation requires some way to read the colors of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> in a canvas. That can be done with the function <em>graphics.getPixelData(x,y,w,h)</em>, where graphics is a 2D graphics context for the canvas. The function reads the colors of a rectangle of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr>, where (x,y) is the upper left corner of the rectangle, w is its width, and h is its height. The parameters are always expressed in <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> coordinates. Consider, for example</p>
<div class="highlight"><pre><span></span><code><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">0</span><span class="p">,</span><span class="mf">20</span><span class="p">,</span><span class="mf">10</span><span class="p">)</span>
</code></pre></div>
<p>This returns the color data for a 20-by-10 rectangle in the upper left corner of the canvas. The return value, colors, is an object with properties <em>colors.width</em>, <em>colors.height</em>, and <em>colors.data</em>. The width and height give the number of rows and columns of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> in the returned data. (According to the documentation, on a high-resolution screen, they might not be the same as the width and height in the function call. The data can be for real, physical <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> on the display device, not the "nominal" <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> that are used in the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> <abbr title="A way of assigning numerical coordinates to geometric points. In two dimensions, each point corresponds to a pair of numbers. In three dimensions, each point corresponds to a triple of numbers.">coordinate system</abbr> on the canvas. There might be several device <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> for each nominal <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>. I'm not sure whether this can really happen in practice.)</p>
<p>The value of colors.data is an array, with four array elements for each <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>. The four elements contain the red, blue, green, and <abbr title="An extra component (that is, one of the numbers that are used to specify a color) in a color model that is not part of the actual color specification. The alpha component is extra information. It is most often used to specify the degree of transparency of a color.">alpha</abbr> color components of the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>, given as integers in the range 0 to 255. For a <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> that lies outside the canvas, the four component values will all be zero. The array is a value of type Uint8ClampedArray whose elements are 8-bit unsigned integers limited to the range 0 to 255. This is one of <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>'s <strong><abbr title="In JavaScript, an array type that is limited to holding numerical values of a single type. For example, the type Float32Array represents arrays that can hold 32-bit floating point values, and Uint8Array arrays can hold only 8-bit integer values. Such arrays are more efficient than general JavaScript arrays for numerical calculations. The were introduced into JavaScript along with HTML canvas graphics and WebGL.">typed array</abbr></strong> datatypes, which can only hold values of a specific numerical type. As an example, suppose that you just want to read the <abbr title="A color specified by three numbers giving the amount of red, green, and blue in the color.">RGB color</abbr> of one <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>, at coordinates (x,y). You can set</p>
<div class="highlight"><pre><span></span><code><span class="nx">pixel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">1</span><span class="p">);</span>
</code></pre></div>
<p>Then the <abbr title="A color specified by three numbers giving the amount of red, green, and blue in the color.">RGB color</abbr> components for the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> are <code>R = pixel.data[0]</code>, <code>G = pixel.data[1]</code>, and <code>B = pixel.data[2]</code>.</p>
<p>The function <em>graphics.putImageData(imageData,x,y)</em> is used to copy the colors from an image data object into a canvas, placing it into a rectangle in the canvas with upper left corner at (x,y). The imageData object can be one that was returned by a call to <em>graphics.getImageData</em>, possibly with its color data modified. Or you can create a blank image data object by calling <em>graphics.createImageData(w,h)</em> and fill it with data.</p>
<p>Let's consider the "Smudge" tool in the sample program. When the user clicks the mouse with this tool, I use <em>OSG.getImageData</em> to get the color data from a 9-by-9 square of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> surrounding the mouse location. OSG is the graphics context for the canvas that contains the image. Since I want to do real-number arithmetic with color values, I copy the color components into another <abbr title="In JavaScript, an array type that is limited to holding numerical values of a single type. For example, the type Float32Array represents arrays that can hold 32-bit floating point values, and Uint8Array arrays can hold only 8-bit integer values. Such arrays are more efficient than general JavaScript arrays for numerical calculations. The were introduced into JavaScript along with HTML canvas graphics and WebGL.">typed array</abbr>, one of type <ins class="critic">Float32Array</ins>, which can hold 32-bit floating point numbers. Here is the function that I call to do this:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">grabSmudgeData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// (x,y) gives mouse location</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">smudgeColorArray</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">null</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Make image data &amp; array the first time this function is called.</span>
<span class="w">        </span><span class="nx">smudgeImageData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">createImageData</span><span class="p">(</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span>
<span class="w">        </span><span class="nx">smudgeColorArray</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Float32Array</span><span class="p">(</span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Copy the color component data into the Float32Array.</span>
<span class="w">        </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The floating point array, <em>smudgeColorArray</em>, will be used for computing new color values for the image as the mouse moves. The color values from this array will be copied into the image data object, <em>smudgeImageData</em>, which will then be used to put the color values into the image. This is done in another function, which is called for each point that is visited as the user drags the Smudge tool over the canvas:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">swapSmudgeData</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// (x,y) is new mouse location</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">colors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">getImageData</span><span class="p">(</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="mf">9</span><span class="p">,</span><span class="mf">9</span><span class="p">);</span><span class="w">  </span><span class="c1">// get color data from image</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">4</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// The color data for one pixel is in the next four array locations.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// alpha-components are non-zero; both pixels are in the canvas;</span>
<span class="w">            </span><span class="c1">// (getImageData() gets 0 for the alpha value at pixel coordinates</span>
<span class="w">            </span><span class="c1">// that are not actually part of the canvas).</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="c1">// compute new RGB values</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">newSmudge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="p">;</span>
<span class="w">                </span><span class="kd">let</span><span class="w"> </span><span class="nx">newImage</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">colors</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">*</span><span class="mf">0.8</span><span class="p">;</span>
<span class="w">                </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newImage</span><span class="p">;</span>
<span class="w">                </span><span class="nx">smudgeColorArray</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">newSmudge</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">            </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">255</span><span class="p">;</span><span class="w">  </span><span class="c1">// alpha component</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// one of the alpha components is zero; set the output</span>
<span class="w">            </span><span class="c1">// color to all zeros, &quot;transparent black&quot;, which will have</span>
<span class="w">            </span><span class="c1">// no effect on the color of the pixel in the canvas.</span>
<span class="w">            </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">let</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">i</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nx">i</span><span class="o">+</span><span class="mf">3</span><span class="p">;</span><span class="w"> </span><span class="nx">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">smudgeImageData</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"> </span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">OSG</span><span class="p">.</span><span class="nx">putImageData</span><span class="p">(</span><span class="nx">smudgeImageData</span><span class="p">,</span><span class="nx">x</span><span class="o">-</span><span class="mf">5</span><span class="p">,</span><span class="nx">y</span><span class="o">-</span><span class="mf">5</span><span class="p">);</span><span class="w"> </span><span class="c1">// copy new colors into canvas</span>
<span class="p">}</span>
</code></pre></div>
<p>In this function, a new color is computed for each <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> in a 9-by-9 square of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> around the mouse location. The color is replaced by a weighted average of the current color of the <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> and the color of the corresponding <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> in the <em>smudgeColorArray</em>. At the same time, the color in <em>smudgeColorArray</em> is replaced by a similar weighted average.</p>
<p>It would be worthwhile to try to understand this example to see how <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr>-by-<abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> processing of color data can be done. See the <a href="../../../en/source/canvas2d/SimplePaintProgram.html">source code</a> of the example for more details.</p>
</div>
</div>
</div>
<h2 id="267--图像">2.6.7  图像<a class="headerlink" href="#267--图像" title="Permanent link">&para;</a></h2>
<p><strong>Images</strong></p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">中文</label><label for="__tabbed_8_2">英文</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>作为另一个像素操作的示例，我们可以看一下图像滤镜，它通过将每个像素的颜色替换为其周围8个像素的颜色的加权平均值来修改图像。根据使用的加权因子，结果可能是图像的轻微模糊版本，或者可能是更有趣的东西。</p>
<p>以下是一个交互式演示，它允许您将几种不同的图像滤镜应用于各种图像：</p>
<p><iframe src="../../../en/demos/c2/image-filters.html" width="600" height="310"></iframe></p>
<p>演示中的过滤操作使用了上面讨论过的图像数据函数 getImageData、createImageData 和 putImageData。通过调用 getImageData 获得整个图像的颜色数据。加权平均计算的结果被放置在一个新的图像数据对象中，然后将结果图像数据复制回图像中使用 putImageData。</p>
<p>剩下的问题是，原始图像从哪里来，它们如何首先出现在画布上？网页中的图像由网页源代码中的元素指定，例如</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;pic.jpg&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mypic&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p><em>src</em> 属性指定加载图像的 <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr>。可选的 <em>id</em> 可以用于在 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 中引用图像。在脚本中，</p>
<div class="highlight"><pre><span></span><code><span class="nx">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;mypic&quot;</span><span class="p">);</span>
</code></pre></div>
<p>获取了表示文档结构中图像的对象的引用。一旦您拥有了这样一个对象，就可以使用它将图像绘制到画布上。如果 graphics 是画布的图形上下文，则</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
</code></pre></div>
<p>将图像绘制在其左上角为 (x,y) 的位置。点 (x,y) 和图像本身都会受到图形上下文中的任何变换的影响。这将以其自然的宽度和高度绘制图像（如果有变换，则会缩放）。您还可以指定绘制图像的矩形的宽度和高度：</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>
</code></pre></div>
<p>使用这个版本的 drawImage，图像将被缩放以适应指定的矩形。</p>
<p>现在，假设您要绘制到画布上的图像不是网页的一部分？在这种情况下，可以动态加载图像。这很像创建一个离屏画布，但你在创建一个"离屏图像"。使用 document 对象创建一个 img 元素：</p>
<div class="highlight"><pre><span></span><code><span class="nx">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
</code></pre></div>
<p>一个 img 元素需要一个 src <abbr title="图形对象的属性，例如颜色。图像可以通过其包含的几何形状以及它们的属性来指定。">属性</abbr>，指定要加载的 <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr>。例如，</p>
<div class="highlight"><pre><span></span><code><span class="nx">newImage</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pic2.jpg&quot;</span><span class="p">;</span>
</code></pre></div>
<p>一旦给 src 属性赋值，浏览器就开始加载图像。加载是异步进行的；也就是说，计算机继续执行脚本而不等待加载完成。这意味着您不能简单地在上面的赋值语句之后的行上绘制图像：此时图像很可能还没有加载完成。您希望在图像加载完成后绘制图像。为了实现这一点，您需要在设置 src 之前将一个函数分配给图像的 onload <abbr title="图形对象的属性，例如颜色。图像可以通过其包含的几何形状以及它们的属性来指定。">属性</abbr>。当图像加载完全时，该函数将被调用。将这些组合在一起，下面是一个简单的 <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> 函数，用于从指定的 <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr> 加载图像，并在加载完成后将其绘制到画布上：</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">loadAndDraw</span><span class="p">(</span><span class="w"> </span><span class="nx">imageURL</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">image</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">doneLoading</span><span class="p">;</span>
<span class="w">    </span><span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">imageURL</span><span class="p">;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">doneLoading</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>在滤镜演示中也使用了类似的技术来加载图像。</p>
<p>最后还有一个谜要解决。在本节前面讨论 SimplePaintProgram 示例中使用离屏画布时，我指出了离屏画布的内容必须复制到主画布上，但我没有说明如何实现。事实上，使用 drawImage 就可以做到。除了将图像绘制到画布上，drawImage 还可以用来将一个画布的内容绘制到另一个画布上。在示例程序中，命令</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="w"> </span><span class="nx">OSC</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>用于将离屏画布绘制到主画布上。这里，graphics 是用于在主画布上绘制的图形上下文，而 OSC 是表示离屏画布的对象。</p>
</div>
<div class="tabbed-block">
<p>For another example of <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> manipulation, we can look at image filters that modify an image by replacing the color of each <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> with a weighted average of the color of that <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixel</abbr> and the 8 <abbr title="A digital image is made up of rows and columns of small rectangles called pixels. To specify a digital image, a color is assigned to each pixel in the image.">pixels</abbr> that surround it. Depending on the weighting factors that are used, the result can be as simple as a slightly blurred version of the image, or it can be something more interesting.</p>
<p>Here is an an interactive demo that lets you apply several different image filters to a variety of images:</p>
<p><iframe src="../../../en/demos/c2/image-filters.html" width="600" height="310"></iframe></p>
<p>The filtering operation in the demo uses the image data functions getImageData, createImageData, and putImageData that were discussed above. Color data from the entire image is obtained with a call to getImageData. The results of the averaging computation are placed in a new image data object, and the resulting image data is copied back to the image using putImageData.</p>
<p>The remaining question is, where do the original images come from, and how do they get onto the canvas in the first place? An image on a web page is specified by an element in the web page source such as</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">img</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;pic.jpg&quot;</span> <span class="na">width</span><span class="o">=</span><span class="s">&quot;400&quot;</span> <span class="na">height</span><span class="o">=</span><span class="s">&quot;300&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;mypic&quot;</span><span class="p">&gt;</span>
</code></pre></div>
<p>The <em>src</em> <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr> specifies the <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr> from which the image is loaded. The optional <em>id</em> can be used to reference the image in <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>. In the script,</p>
<p>The src <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr> specifies the <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr> from which the image is loaded. The optional id can be used to reference the image in <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr>. In the script,</p>
<div class="highlight"><pre><span></span><code><span class="nx">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;mypic&quot;</span><span class="p">);</span>
</code></pre></div>
<p>gets a reference to the object that represents the image in the document structure. Once you have such an object, you can use it to draw the image on a canvas. If graphics is a graphics context for the canvas, then</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
</code></pre></div>
<p>draws the image with its upper left corner at (x,y). Both the point (x,y) and the image itself are transformed by any transformation in effect in the graphics context. This will draw the image using its natural width and height (scaled by the transformation, if any). You can also specify the width and height of the rectangle in which the image is drawn:</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">,</span><span class="w"> </span><span class="nx">width</span><span class="p">,</span><span class="w"> </span><span class="nx">height</span><span class="p">);</span>
</code></pre></div>
<p>With this version of drawImage, the image is scaled to fit the specified rectangle.</p>
<p>Now, suppose that the image you want to draw onto the canvas is not part of the web page? In that case, it is possible to load the image dynamically. This is much like making an <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr>, but you are making an "off-screen image." Use the document object to create an img element:</p>
<div class="highlight"><pre><span></span><code><span class="nx">newImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
</code></pre></div>
<p>An img element needs a src <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr> that specifies the <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr> from which it is to be loaded. For example,</p>
<div class="highlight"><pre><span></span><code><span class="nx">newImage</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;pic2.jpg&quot;</span><span class="p">;</span>
</code></pre></div>
<p>As soon as you assign a value to the src <abbr title="A property, such as color, of a graphical object. An image can be specified by the geometric shapes that it contains, together with their attributes.">attribute</abbr>, the browser starts loading the image. The loading is done asynchronously; that is, the computer continues to execute the script without waiting for the load to complete. This means that you can't simply draw the image on the line after the above assignment statement: The image is very likely not done loading at that time. You want to draw the image after it has finished loading. For that to happen, you need to assign a function to the image's onload property before setting the src. That function will be called when the image has been fully loaded. Putting this together, here is a simple <abbr title="A programming language for web pages. JavaScript code on a web page is executed by a web browser that displays the page, and it can interact with the contents of the web page and with the user. There are JavaScript APIs for 2D and for 3D graphics">JavaScript</abbr> function for loading an image from a specified <abbr title="Uniform Resource Locator. An address of some resource on the World Wide Web. For example, &quot;&lt;http://math.hws.edu/grahicsbook&gt;&quot;.">URL</abbr> and drawing it on a canvas after it has loaded:</p>
<div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">loadAndDraw</span><span class="p">(</span><span class="w"> </span><span class="nx">imageURL</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">image</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
<span class="w">    </span><span class="nx">image</span><span class="p">.</span><span class="nx">onload</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">doneLoading</span><span class="p">;</span>
<span class="w">    </span><span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">imageURL</span><span class="p">;</span>
<span class="w">    </span><span class="kd">function</span><span class="w"> </span><span class="nx">doneLoading</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">image</span><span class="p">,</span><span class="w"> </span><span class="nx">x</span><span class="p">,</span><span class="w"> </span><span class="nx">y</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A similar technique is used to load the images in the filter demo.</p>
<p>There is one last mystery to clear up. When discussing the use of an <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> in the SimplePaintProgram example earlier in this section, I noted that the contents of the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> have to be copied to the main canvas, but I didn't say how that can be done. In fact, it is done using drawImage. In addition to drawing an image onto a canvas, drawImage can be used to draw the contents of one canvas into another canvas. In the sample program, the command</p>
<div class="highlight"><pre><span></span><code><span class="nx">graphics</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="w"> </span><span class="nx">OSC</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="p">);</span>
</code></pre></div>
<p>is used to draw the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr> to the main canvas. Here, graphics is a graphics context for drawing on the main canvas, and OSC is the object that represents the <abbr title="My term for a segment of the computer's memory that can be used as a drawing surface, for drawing images that are not visible on the screen. Some method should exist for copying the image from an off-screen canvas onto the screen. In Java, for example, an off-screen canvas can be implemented as an object of type BufferedImage.">off-screen canvas</abbr>.</p>
</div>
</div>
</div>







  
    
  
  
    
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="最后更新">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年5月13日</span>
  </span>

    
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="创建日期">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14.47 15.08 11 13V7h1.5v5.25l3.08 1.83c-.41.28-.79.62-1.11 1m-1.39 4.84c-.36.05-.71.08-1.08.08-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8c0 .37-.03.72-.08 1.08.69.1 1.33.32 1.92.64.1-.56.16-1.13.16-1.72 0-5.5-4.5-10-10-10S2 6.5 2 12s4.47 10 10 10c.59 0 1.16-.06 1.72-.16-.32-.59-.54-1.23-.64-1.92M18 15v3h-3v2h3v3h2v-3h3v-2h-3v-3h-2Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">2024年4月25日</span>
  </span>

    
    
    
  </aside>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "content.tabs.link", "navigation.tabs", "navigation.tabs.sticky", "navigation.indexes", "navigation.top", "toc.follow", "content.tooltips"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>